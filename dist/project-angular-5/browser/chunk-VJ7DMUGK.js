import{A as x,B as wi,C as io,D as Et,E as W,F as ge,G as fn,H as Ei,I as so,J as Ye,K as Ct,M as ro,N as oo,O as pn,P as _n,Q as Z,R as $,a as f,b as Qe,c as un,d as zr,e as qr,g as D,h as Qr,i as vi,j as Yr,k as le,l as Xr,n as Zr,o as hn,p as P,q as Jr,r as eo,s as X,t as Te,u as dn,v as wt,w as to,x as no,y as g,z as j}from"./chunk-AEVFTGS7.js";import{Eb as $r,F as Lr,H as Wr,K as _i,L as Ur,M as gi,O as Br,Q as _e,R as mi,T as Vr,U as jr,X as Ee,Y as an,_ as L,aa as C,c as ve,ca as vt,f as Or,fa as ln,gb as Kr,h as on,ha as Hr,hb as cn,i as Mr,k as we,l as Fe,m as pi,n as Le,ob as yi,pa as Gr,r as K,ta as ae,x as yt,y as Fr,za as Ce}from"./chunk-ZY2ILMC6.js";import{a as xr,b as Dr,f as oe}from"./chunk-3UWLOQQ6.js";var ql="firebase",Ql="10.13.0";Z(ql,Ql,"app");var Ie=new Kr("ANGULARFIRE2_VERSION");function Yd(n,e,t){if(e){if(e.length===1)return e[0];let r=e.filter(o=>o.app===t);if(r.length===1)return r[0]}return t.container.getProvider(n).getImmediate({optional:!0})}var Yl=(n,e)=>{let t=e?[e]:_n(),i=[];return t.forEach(s=>{s.container.getProvider(n).instances.forEach(o=>{i.includes(o)||i.push(o)})}),i},Ue=class{constructor(){return Yl(Xl)}},Xl="app-check";function Xe(){}var gn=class{zone;delegate;constructor(e,t=Mr){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,i){let s=this.zone,r=function(o){s.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(r,t,i)}},Ci=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let i=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",Xe,{},Xe,Xe)),t.pipe(Vr({next:i,complete:i,error:i})).subscribe(e).add(i)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},Ze=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new gn(Zone.current)),this.insideAngular=t.run(()=>new gn(Zone.current,on)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(i){return new(i||n)(C(ae))};static \u0275prov=Ee({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function yn(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function Zl(n){return yn().ngZone.runOutsideAngular(()=>n())}function We(n){return yn().ngZone.run(()=>n())}function ce(n){return Jl(yn())(n)}function Jl(n){return function(t){return t=t.lift(new Ci(n.ngZone)),t.pipe(Fe(n.outsideAngular),we(n.insideAngular))}}var ec=(n,e)=>function(){let i=arguments;return e&&setTimeout(()=>{e.state==="scheduled"&&e.invoke()},10),We(()=>n.apply(void 0,i))},ao=(n,e)=>function(){let t,i=arguments;for(let r=0;r<arguments.length;r++)typeof i[r]=="function"&&(e&&(t||=We(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",Xe,{},Xe,Xe))),i[r]=ec(i[r],t));let s=Zl(()=>n.apply(this,i));if(!e)if(s instanceof ve){let r=yn();return s.pipe(Fe(r.outsideAngular),we(r.insideAngular))}else return We(()=>s);return s instanceof ve?s.pipe(ce):s instanceof Promise?We(()=>new Promise((r,o)=>s.then(a=>We(()=>r(a)),a=>We(()=>o(a))))):typeof s=="function"&&t?function(){return setTimeout(()=>{t&&t.state==="scheduled"&&t.invoke()},10),s.apply(this,arguments)}:We(()=>s)};var Tt=class{constructor(e){return e}},Ti=class{constructor(){return _n()}};function tc(n){return n&&n.length===1?n[0]:new Tt(pn())}var Ii=new L("angularfire2._apps"),nc={provide:Tt,useFactory:tc,deps:[[new vt,Ii]]},ic={provide:Ti,deps:[[new vt,Ii]]};function sc(n){return(e,t)=>{let i=t.get(Ce);Z("angularfire",Ie.full,"core"),Z("angularfire",Ie.full,"app"),Z("angular",cn.full,i.toString());let s=e.runOutsideAngular(()=>n(t));return new Tt(s)}}function af(n,...e){return Hr([nc,ic,{provide:Ii,useFactory:sc(n),multi:!0,deps:[ae,Gr,Ze,...e]}])}var lf=ao(oo,!0);var oc=new Map,ac={activated:!1,tokenObservers:[]},lc={initialized:!1,enabled:!1};function ie(n){return oc.get(n)||Object.assign({},ac)}function po(){return lc}var cc="https://content-firebaseappcheck.googleapis.com/v1";var uc="exchangeDebugToken",co={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},vf=24*60*60*1e3;var bi=class{constructor(e,t,i,s,r){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=i,this.lowerBound=s,this.upperBound=r,this.pending=null,this.nextErrorWaitInterval=s,s>r)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return oe(this,null,function*(){this.stop();try{this.pending=new D,this.pending.promise.catch(t=>{}),yield hc(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new D,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function hc(n){return new Promise(e=>{setTimeout(e,n)})}var dc={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},Se=new Zr("appCheck","AppCheck",dc);function _o(n){if(!ie(n).activated)throw Se.create("use-before-activation",{appName:n.name})}function go(i,s){return oe(this,arguments,function*({url:n,body:e},t){let r={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let p=yield o.getHeartbeatsHeader();p&&(r["X-Firebase-Client"]=p)}let a={method:"POST",body:JSON.stringify(e),headers:r},l;try{l=yield fetch(n,a)}catch(p){throw Se.create("fetch-network-error",{originalErrorMessage:p?.message})}if(l.status!==200)throw Se.create("fetch-status-error",{httpStatus:l.status});let c;try{c=yield l.json()}catch(p){throw Se.create("fetch-parse-error",{originalErrorMessage:p?.message})}let u=c.ttl.match(/^([\d.]+)(s)$/);if(!u||!u[2]||isNaN(Number(u[1])))throw Se.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${c.ttl}`});let h=Number(u[1])*1e3,d=Date.now();return{token:c.token,expireTimeMillis:d+h,issuedAtTimeMillis:d}})}function mo(n,e){let{projectId:t,appId:i,apiKey:s}=n.options;return{url:`${cc}/projects/${t}/apps/${i}:${uc}?key=${s}`,body:{debug_token:e}}}var fc="firebase-app-check-database",pc=1,Ai="firebase-app-check-store";var vn=null;function _c(){return vn||(vn=new Promise((n,e)=>{try{let t=indexedDB.open(fc,pc);t.onsuccess=i=>{n(i.target.result)},t.onerror=i=>{var s;e(Se.create("storage-open",{originalErrorMessage:(s=i.target.error)===null||s===void 0?void 0:s.message}))},t.onupgradeneeded=i=>{let s=i.target.result;switch(i.oldVersion){case 0:s.createObjectStore(Ai,{keyPath:"compositeKey"})}}}catch(t){e(Se.create("storage-open",{originalErrorMessage:t?.message}))}}),vn)}function gc(n,e){return mc(yc(n),e)}function mc(n,e){return oe(this,null,function*(){let i=(yield _c()).transaction(Ai,"readwrite"),r=i.objectStore(Ai).put({compositeKey:n,value:e});return new Promise((o,a)=>{r.onsuccess=l=>{o()},i.onerror=l=>{var c;a(Se.create("storage-set",{originalErrorMessage:(c=l.target.error)===null||c===void 0?void 0:c.message}))}})})}function yc(n){return`${n.options.appId}-${n.name}`}var ki=new Ye("@firebase/app-check");function Si(n,e){return Xr()?gc(n,e).catch(t=>{ki.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function yo(){return po().enabled}function vo(){return oe(this,null,function*(){let n=po();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var vc={error:"UNKNOWN_ERROR"};function wc(n){return un.encodeString(JSON.stringify(n),!1)}function Ri(n,e=!1){return oe(this,null,function*(){let t=n.app;_o(t);let i=ie(t),s=i.token,r;if(s&&!It(s)&&(i.token=void 0,s=void 0),!s){let l=yield i.cachedTokenPromise;l&&(It(l)?s=l:yield Si(t,void 0))}if(!e&&s&&It(s))return{token:s.token};let o=!1;if(yo()){i.exchangeTokenPromise||(i.exchangeTokenPromise=go(mo(t,yield vo()),n.heartbeatServiceProvider).finally(()=>{i.exchangeTokenPromise=void 0}),o=!0);let l=yield i.exchangeTokenPromise;return yield Si(t,l),i.token=l,{token:l.token}}try{i.exchangeTokenPromise||(i.exchangeTokenPromise=i.provider.getToken().finally(()=>{i.exchangeTokenPromise=void 0}),o=!0),s=yield ie(t).exchangeTokenPromise}catch(l){l.code==="appCheck/throttled"?ki.warn(l.message):ki.error(l),r=l}let a;return s?r?It(s)?a={token:s.token,internalError:r}:a=ho(r):(a={token:s.token},i.token=s,yield Si(t,s)):a=ho(r),o&&Ic(t,a),a})}function Ec(n){return oe(this,null,function*(){let e=n.app;_o(e);let{provider:t}=ie(e);if(yo()){let i=yield vo(),{token:s}=yield go(mo(e,i),n.heartbeatServiceProvider);return{token:s}}else{let{token:i}=yield t.getToken();return{token:i}}})}function Cc(n,e,t,i){let{app:s}=n,r=ie(s),o={next:t,error:i,type:e};if(r.tokenObservers=[...r.tokenObservers,o],r.token&&It(r.token)){let a=r.token;Promise.resolve().then(()=>{t({token:a.token}),uo(n)}).catch(()=>{})}r.cachedTokenPromise.then(()=>uo(n))}function wo(n,e){let t=ie(n),i=t.tokenObservers.filter(s=>s.next!==e);i.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=i}function uo(n){let{app:e}=n,t=ie(e),i=t.tokenRefresher;i||(i=Tc(n),t.tokenRefresher=i),!i.isRunning()&&t.isTokenAutoRefreshEnabled&&i.start()}function Tc(n){let{app:e}=n;return new bi(()=>oe(this,null,function*(){let t=ie(e),i;if(t.token?i=yield Ri(n,!0):i=yield Ri(n),i.error)throw i.error;if(i.internalError)throw i.internalError}),()=>!0,()=>{let t=ie(e);if(t.token){let i=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,s=t.token.expireTimeMillis-5*60*1e3;return i=Math.min(i,s),Math.max(0,i-Date.now())}else return 0},co.RETRIAL_MIN_WAIT,co.RETRIAL_MAX_WAIT)}function Ic(n,e){let t=ie(n).tokenObservers;for(let i of t)try{i.type==="EXTERNAL"&&e.error!=null?i.error(e.error):i.next(e)}catch{}}function It(n){return n.expireTimeMillis-Date.now()>0}function ho(n){return{token:wc(vc),error:n}}var Ni=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=ie(this.app);for(let t of e)wo(this.app,t.next);return Promise.resolve()}};function Sc(n,e){return new Ni(n,e)}function bc(n){return{getToken:e=>Ri(n,e),getLimitedUseToken:()=>Ec(n),addTokenListener:e=>Cc(n,"INTERNAL",e),removeTokenListener:e=>wo(n.app,e)}}var Ac="@firebase/app-check",kc="0.8.7";var Rc="app-check",fo="app-check-internal";function Nc(){Ct(new ge(Rc,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return Sc(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(fo).initialize()})),Ct(new ge(fo,n=>{let e=n.getProvider("app-check").getImmediate();return bc(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),Z(Ac,kc)}Nc();var Pc=["localhost","0.0.0.0","127.0.0.1"],Pf=typeof window<"u"&&Pc.includes(window.location.hostname);var xc="firebase",Dc="10.13.0";$.registerVersion(xc,Dc,"app-compat");var Oc=["ngOnDestroy"],To=(n,e,t,i={})=>new Proxy(n,{get:(s,r)=>t.runOutsideAngular(()=>{if(n[r])return i?.spy?.get&&i.spy.get(r,n[r]),n[r];if(Oc.indexOf(r)>-1)return()=>{};let o=e.toPromise().then(a=>{let l=a?.[r];return typeof l=="function"?l.bind(a):l?.then?l.then(c=>t.run(()=>c)):t.run(()=>l)});return new Proxy(()=>{},{get:(a,l)=>o[l],apply:(a,l,c)=>o.then(u=>{let h=u?.(...c);return i?.spy?.apply&&i.spy.apply(r,c,h),h})})})});var wn=class{constructor(e){return e}},Je=new L("angularfire2.app.options"),et=new L("angularfire2.app.name");function St(n,e,t){let i=typeof t=="string"&&t||"[DEFAULT]",s=typeof t=="object"&&t||{};s.name=s.name||i;let o=$.apps.filter(a=>a&&a.name===s.name)[0]||e.runOutsideAngular(()=>$.initializeApp(n,s));try{if(JSON.stringify(n)!==JSON.stringify(o.options)){let a=!!module.hot;Mc("error",`${o.name} Firebase App already initialized with different options${a?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new wn(o)}var Mc=(n,...e)=>{yi()&&typeof console<"u"&&console[n](...e)},Fc={provide:wn,useFactory:St,deps:[Je,ae,[new vt,et]]},jf=(()=>{class n{static initializeApp(t,i){return{ngModule:n,providers:[{provide:Je,useValue:t},{provide:et,useValue:i}]}}constructor(t){$.registerVersion("angularfire",Ie.full,"core"),$.registerVersion("angularfire",Ie.full,"app-compat"),$.registerVersion("angular",cn.full,t.toString())}static \u0275fac=function(i){return new(i||n)(C(Ce))};static \u0275mod=ln({type:n});static \u0275inj=an({providers:[Fc]})}return n})();function En(n,e,t,i,s){let[,r,o]=globalThis.\u0275AngularfireInstanceCache.find(a=>a[0]===n)||[];if(r)return Lc(s,o)||(Co("error",`${e} was already initialized on the ${t} Firebase App with different settings.${Wc?" You may need to reload as Firebase is not HMR aware.":""}`),Co("warn",{is:s,was:o})),r;{let a=i();return globalThis.\u0275AngularfireInstanceCache.push([n,a,s]),a}}function Lc(n,e){try{return n.toString()===e.toString()}catch{return n===e}}var Wc=typeof module<"u"&&!!module.hot,Co=(n,...e)=>{yi()&&typeof console<"u"&&console[n](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var Pi=new L("angularfire2.auth.use-emulator"),xi=new L("angularfire2.auth.settings"),Di=new L("angularfire2.auth.tenant-id"),Oi=new L("angularfire2.auth.langugage-code"),Mi=new L("angularfire2.auth.use-device-language"),Fi=new L("angularfire.auth.persistence"),Li=(n,e,t,i,s,r,o,a)=>En(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{let l=e.runOutsideAngular(()=>n.auth());if(t&&l.useEmulator(...t),i&&(l.tenantId=i),l.languageCode=s,r&&l.useDeviceLanguage(),o)for(let[c,u]of Object.entries(o))l.settings[c]=u;return a&&l.setPersistence(a),l},[t,i,s,r,o,a]),Io=(()=>{class n{authState;idToken;user;idTokenResult;credential;constructor(t,i,s,r,o,a,l,c,u,h,d,p){let _=new Or,E=Le(void 0).pipe(we(o.outsideAngular),_e(()=>r.runOutsideAngular(()=>import("./chunk-M4BG7SDG.js"))),K(()=>St(t,r,i)),K(S=>Li(S,r,a,c,u,h,l,d)),gi({bufferSize:1,refCount:!1}));if($r(s))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=Le(null);else{E.pipe(Wr()).subscribe();let S=E.pipe(_e(k=>k.getRedirectResult().then(ne=>ne,()=>null)),ce,gi({bufferSize:1,refCount:!1})),H=E.pipe(_e(k=>new ve(ne=>({unsubscribe:r.runOutsideAngular(()=>k.onAuthStateChanged(Me=>ne.next(Me),Me=>ne.error(Me),()=>ne.complete()))})))),G=E.pipe(_e(k=>new ve(ne=>({unsubscribe:r.runOutsideAngular(()=>k.onIdTokenChanged(Me=>ne.next(Me),Me=>ne.error(Me),()=>ne.complete()))}))));this.authState=S.pipe(mi(H),Fe(o.outsideAngular),we(o.insideAngular)),this.user=S.pipe(mi(G),Fe(o.outsideAngular),we(o.insideAngular)),this.idToken=this.user.pipe(_e(k=>k?pi(k.getIdToken()):Le(null))),this.idTokenResult=this.user.pipe(_e(k=>k?pi(k.getIdTokenResult()):Le(null))),this.credential=yt(S,_,this.authState.pipe(Fr(k=>!k))).pipe(K(k=>k?.user?k:null),Fe(o.outsideAngular),we(o.insideAngular))}return To(this,E,r,{spy:{apply:(S,H,G)=>{(S.startsWith("signIn")||S.startsWith("createUser"))&&G.then(k=>_.next(k))}}})}static \u0275fac=function(i){return new(i||n)(C(Je),C(et,8),C(Ce),C(ae),C(Ze),C(Pi,8),C(xi,8),C(Di,8),C(Oi,8),C(Mi,8),C(Fi,8),C(Ue,8))};static \u0275prov=Ee({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();var So="@firebase/database",bo="1.0.7";var Qs="";function Ys(n){Qs=n}var Ki=class{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),P(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:hn(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}};var $i=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return X(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}};var ia=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){let e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Ki(e)}}catch{}return new $i},Ve=ia("localStorage"),zi=ia("sessionStorage");var st=new Ye("@firebase/database"),sa=function(){let n=1;return function(){return n++}}(),ra=function(n){let e=io(n),t=new no;t.update(e);let i=t.digest();return un.encodeByteArray(i)},Qt=function(...n){let e="";for(let t=0;t<n.length;t++){let i=n[t];Array.isArray(i)||i&&typeof i=="object"&&typeof i.length=="number"?e+=Qt.apply(null,i):typeof i=="object"?e+=P(i):e+=i,e+=" "}return e},je=null,Ao=!0,oa=function(n,e){f(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(st.logLevel=so.VERBOSE,je=st.log.bind(st),e&&zi.set("logging_enabled",!0)):typeof n=="function"?je=n:(je=null,zi.remove("logging_enabled"))},O=function(...n){if(Ao===!0&&(Ao=!1,je===null&&zi.get("logging_enabled")===!0&&oa(!0)),je){let e=Qt.apply(null,n);je(e)}},Yt=function(n){return function(...e){O(n,...e)}},qi=function(...n){let e="FIREBASE INTERNAL ERROR: "+Qt(...n);st.error(e)},de=function(...n){let e=`FIREBASE FATAL ERROR: ${Qt(...n)}`;throw st.error(e),new Error(e)},F=function(...n){let e="FIREBASE WARNING: "+Qt(...n);st.warn(e)},Bc=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&F("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Qn=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},Vc=function(n){if(le()||document.readyState==="complete")n();else{let e=!1,t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},Re="[MIN_NAME]",me="[MAX_NAME]",Ge=function(n,e){if(n===e)return 0;if(n===Re||e===me)return-1;if(e===Re||n===me)return 1;{let t=ko(n),i=ko(e);return t!==null?i!==null?t-i===0?n.length-e.length:t-i:-1:i!==null?1:n<e?-1:1}},jc=function(n,e){return n===e?0:n<e?-1:1},bt=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+P(e))},Xs=function(n){if(typeof n!="object"||n===null)return P(n);let e=[];for(let i in n)e.push(i);e.sort();let t="{";for(let i=0;i<e.length;i++)i!==0&&(t+=","),t+=P(e[i]),t+=":",t+=Xs(n[e[i]]);return t+="}",t},aa=function(n,e){let t=n.length;if(t<=e)return[n];let i=[];for(let s=0;s<t;s+=e)s+e>t?i.push(n.substring(s,t)):i.push(n.substring(s,s+e));return i};function M(n,e){for(let t in n)n.hasOwnProperty(t)&&e(t,n[t])}var la=function(n){f(!Qn(n),"Invalid JSON number");let e=11,t=52,i=(1<<e-1)-1,s,r,o,a,l;n===0?(r=0,o=0,s=1/n===-1/0?1:0):(s=n<0,n=Math.abs(n),n>=Math.pow(2,1-i)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),i),r=a+i,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(r=0,o=Math.round(n/Math.pow(2,1-i-t))));let c=[];for(l=t;l;l-=1)c.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)c.push(r%2?1:0),r=Math.floor(r/2);c.push(s?1:0),c.reverse();let u=c.join(""),h="";for(l=0;l<64;l+=8){let d=parseInt(u.substr(l,8),2).toString(16);d.length===1&&(d="0"+d),h=h+d}return h.toLowerCase()},Hc=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},Gc=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function Kc(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");let i=new Error(n+" at "+e._path.toString()+": "+t);return i.code=n.toUpperCase(),i}var $c=new RegExp("^-?(0*)\\d{1,10}$"),zc=-2147483648,qc=2147483647,ko=function(n){if($c.test(n)){let e=Number(n);if(e>=zc&&e<=qc)return e}return null},ft=function(n){try{n()}catch(e){setTimeout(()=>{let t=e.stack||"";throw F("Exception was thrown by user callback.",t),e},Math.floor(0))}},Qc=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Nt=function(n,e){let t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};var Qi=class{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(i=>this.appCheck=i)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,i)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(i=>i.addTokenListener(e))}notifyForInvalidToken(){F(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}};var Yi=class{constructor(e,t,i){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(O("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,i)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',F(e)}},Pt=(()=>{class n{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}n.OWNER="owner";return n})(),Tn="5",ca="v",ua="s",ha="r",da="f",fa=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,pa="ls",_a="p",Xi="ac",ga="websocket",ma="long_polling";var In=class{constructor(e,t,i,s,r=!1,o="",a=!1,l=!1){this.secure=t,this.namespace=i,this.webSocketOnly=s,this.nodeAdmin=r,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Ve.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Ve.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}};function Yc(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function ya(n,e,t){f(typeof e=="string","typeof type must == string"),f(typeof t=="object","typeof params must == object");let i;if(e===ga)i=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===ma)i=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);Yc(n)&&(t.ns=n.namespace);let s=[];return M(t,(r,o)=>{s.push(r+"="+o)}),i+s.join("&")}var Zi=class{constructor(){this.counters_={}}incrementCounter(e,t=1){X(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return qr(this.counters_)}};var Wi={},Ui={};function Zs(n){let e=n.toString();return Wi[e]||(Wi[e]=new Zi),Wi[e]}function Xc(n,e){let t=n.toString();return Ui[t]||(Ui[t]=e()),Ui[t]}var Ji=class{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<i.length;++s)i[s]&&ft(()=>{this.onMessage_(i[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var Ro="start",Zc="close",Jc="pLPCommand",eu="pRTLPCB",va="id",wa="pw",Ea="ser",tu="cb",nu="seg",iu="ts",su="d",ru="dframe",Ca=1870,Ta=30,ou=Ca-Ta,au=25e3,lu=3e4,Mt=class n{constructor(e,t,i,s,r,o,a){this.connId=e,this.repoInfo=t,this.applicationId=i,this.appCheckToken=s,this.authToken=r,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Yt(e),this.stats_=Zs(t),this.urlFn=l=>(this.appCheckToken&&(l[Xi]=this.appCheckToken),ya(t,ma,l))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Ji(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(lu)),Vc(()=>{if(this.isClosed_)return;this.scriptTagHolder=new es((...r)=>{let[o,a,l,c,u]=r;if(this.incrementIncomingBytes_(r),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===Ro)this.id=a,this.password=l;else if(o===Zc)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...r)=>{let[o,a]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);let i={};i[Ro]="t",i[Ea]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(i[tu]=this.scriptTagHolder.uniqueCallbackIdentifier),i[ca]=Tn,this.transportSessionId&&(i[ua]=this.transportSessionId),this.lastSessionId&&(i[pa]=this.lastSessionId),this.applicationId&&(i[_a]=this.applicationId),this.appCheckToken&&(i[Xi]=this.appCheckToken),typeof location<"u"&&location.hostname&&fa.test(location.hostname)&&(i[ha]=da);let s=this.urlFn(i);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){n.forceAllow_=!0}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){return le()?!1:n.forceAllow_?!0:!n.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!Hc()&&!Gc()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=P(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let i=zr(t),s=aa(i,ou);for(let r=0;r<s.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[r]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(le())return;this.myDisconnFrame=document.createElement("iframe");let i={};i[ru]="t",i[va]=e,i[wa]=t,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=P(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}},es=class n{constructor(e,t,i,s){if(this.onDisconnect=i,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,le())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=sa(),window[Jc+this.uniqueCallbackIdentifier]=e,window[eu+this.uniqueCallbackIdentifier]=t,this.myIFrame=n.createIFrame_();let r="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(r='<script>document.domain="'+document.domain+'";<\/script>');let o="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){O("frame writing exception"),a.stack&&O(a.stack),O(a)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||O("No IE domain setting required")}catch{let i=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let e={};e[va]=this.myID,e[wa]=this.myPW,e[Ea]=this.currentSerial;let t=this.urlFn(e),i="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+Ta+i.length<=Ca;){let o=this.pendingSegs.shift();i=i+"&"+nu+s+"="+o.seg+"&"+iu+s+"="+o.ts+"&"+su+s+"="+o.d,s++}return t=t+i,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,i){this.pendingSegs.push({seg:e,ts:t,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let i=()=>{this.outstandingRequests.delete(t),this.newRequest_()},s=setTimeout(i,Math.floor(au)),r=()=>{clearTimeout(s),i()};this.addTag(e,r)}addTag(e,t){le()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,i.onload=i.onreadystatechange=function(){let s=i.readyState;(!s||s==="loaded"||s==="complete")&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),t())},i.onerror=()=>{O("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}};var cu=16384,uu=45e3,Sn=null;typeof MozWebSocket<"u"?Sn=MozWebSocket:typeof WebSocket<"u"&&(Sn=WebSocket);var nt=(()=>{class n{constructor(t,i,s,r,o,a,l){this.connId=t,this.applicationId=s,this.appCheckToken=r,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Yt(this.connId),this.stats_=Zs(i),this.connURL=n.connectionURL_(i,a,l,r,s),this.nodeAdmin=i.nodeAdmin}static connectionURL_(t,i,s,r,o){let a={};return a[ca]=Tn,!le()&&typeof location<"u"&&location.hostname&&fa.test(location.hostname)&&(a[ha]=da),i&&(a[ua]=i),s&&(a[pa]=s),r&&(a[Xi]=r),o&&(a[_a]=o),ya(t,ga,a)}open(t,i){this.onDisconnect=i,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Ve.set("previous_websocket_failure",!0);try{let s;if(le()){let r=this.nodeAdmin?"AdminNode":"Node";s={headers:{"User-Agent":`Firebase/${Tn}/${Qs}/${process.platform}/${r}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(s.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(s.headers["X-Firebase-AppCheck"]=this.appCheckToken);let o=process.env,a=this.connURL.indexOf("wss://")===0?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(s.proxy={origin:a})}this.mySock=new Sn(this.connURL,[],s)}catch(s){this.log_("Error instantiating WebSocket.");let r=s.message||s.data;r&&this.log_(r),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=s=>{this.handleIncomingFrame(s)},this.mySock.onerror=s=>{this.log_("WebSocket error.  Closing connection.");let r=s.message||s.data;r&&this.log_(r),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){let i=/Android ([0-9]{0,}\.[0-9]{0,})/,s=navigator.userAgent.match(i);s&&s.length>1&&parseFloat(s[1])<4.4&&(t=!0)}return!t&&Sn!==null&&!n.forceDisallow_}static previouslyFailed(){return Ve.isInMemoryStorage||Ve.get("previous_websocket_failure")===!0}markConnectionHealthy(){Ve.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){let i=this.frames.join("");this.frames=null;let s=hn(i);this.onMessage(s)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(f(this.frames===null,"We already have a frame buffer"),t.length<=6){let i=Number(t);if(!isNaN(i))return this.handleNewFrameCount_(i),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(this.mySock===null)return;let i=t.data;if(this.bytesReceived+=i.length,this.stats_.incrementCounter("bytes_received",i.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(i);else{let s=this.extractFrameCount_(i);s!==null&&this.appendFrame_(s)}}send(t){this.resetKeepAlive();let i=P(t);this.bytesSent+=i.length,this.stats_.incrementCounter("bytes_sent",i.length);let s=aa(i,cu);s.length>1&&this.sendString_(String(s.length));for(let r=0;r<s.length;r++)this.sendString_(s[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(uu))}sendString_(t){try{this.mySock.send(t)}catch(i){this.log_("Exception thrown from WebSocket.send():",i.message||i.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4;return n})(),Ia=(()=>{class n{constructor(t){this.initTransports_(t)}static get ALL_TRANSPORTS(){return[Mt,nt]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(t){let i=nt&&nt.isAvailable(),s=i&&!nt.previouslyFailed();if(t.webSocketOnly&&(i||F("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[nt];else{let r=this.transports_=[];for(let o of n.ALL_TRANSPORTS)o&&o.isAvailable()&&r.push(o);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}n.globalTransportInitialized_=!1;return n})(),hu=6e4,du=5e3,fu=10*1024,pu=100*1024,Bi="t",No="d",_u="s",Po="r",gu="e",xo="o",Do="a",Oo="n",Mo="p",mu="h",ts=class{constructor(e,t,i,s,r,o,a,l,c,u){this.id=e,this.repoInfo_=t,this.applicationId_=i,this.appCheckToken_=s,this.authToken_=r,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=c,this.lastSessionId=u,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Yt("c:"+this.id+":"),this.transportManager_=new Ia(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,i)},Math.floor(0));let s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=Nt(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>pu?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>fu?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){let t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(Bi in e){let t=e[Bi];t===Do?this.upgradeIfSecondaryHealthy_():t===Po?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===xo&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=bt("t",e),i=bt("d",e);if(t==="c")this.onSecondaryControl_(i);else if(t==="d")this.pendingDataMessages.push(i);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:Mo,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:Do,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:Oo,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=bt("t",e),i=bt("d",e);t==="c"?this.onControl_(i):t==="d"&&this.onDataMessage_(i)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=bt(Bi,e);if(No in e){let i=e[No];if(t===mu){let s=Object.assign({},i);this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(t===Oo){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===_u?this.onConnectionShutdown_(i):t===Po?this.onReset_(i):t===gu?qi("Server Error: "+i):t===xo?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):qi("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,i=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),Tn!==i&&F("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,i),Nt(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(hu))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Nt(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(du))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:Mo,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Ve.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var bn=class{put(e,t,i,s){}merge(e,t,i,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,i){}onDisconnectMerge(e,t,i){}onDisconnectCancel(e,t){}reportStats(e){}};var An=class{constructor(e){this.allowedEvents_=e,this.listeners_={},f(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let i=[...this.listeners_[e]];for(let s=0;s<i.length;s++)i[s].callback.apply(i[s].context,t)}}on(e,t,i){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:i});let s=this.getInitialEvent(e);s&&t.apply(i,s)}off(e,t,i){this.validateEventType_(e);let s=this.listeners_[e]||[];for(let r=0;r<s.length;r++)if(s[r].callback===t&&(!i||i===s[r].context)){s.splice(r,1);return}}validateEventType_(e){f(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}};var kn=class n extends An{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!vi()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new n}getInitialEvent(e){return f(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}};var Fo=32,Lo=768,I=class{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let i=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[i]=this.pieces_[s],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}};function T(){return new I("")}function y(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function Ne(n){return n.pieces_.length-n.pieceNum_}function b(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new I(n.pieces_,e)}function Js(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function yu(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function Ft(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function Sa(n){if(n.pieceNum_>=n.pieces_.length)return null;let e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new I(e,0)}function R(n,e){let t=[];for(let i=n.pieceNum_;i<n.pieces_.length;i++)t.push(n.pieces_[i]);if(e instanceof I)for(let i=e.pieceNum_;i<e.pieces_.length;i++)t.push(e.pieces_[i]);else{let i=e.split("/");for(let s=0;s<i.length;s++)i[s].length>0&&t.push(i[s])}return new I(t,0)}function v(n){return n.pieceNum_>=n.pieces_.length}function U(n,e){let t=y(n),i=y(e);if(t===null)return e;if(t===i)return U(b(n),b(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function vu(n,e){let t=Ft(n,0),i=Ft(e,0);for(let s=0;s<t.length&&s<i.length;s++){let r=Ge(t[s],i[s]);if(r!==0)return r}return t.length===i.length?0:t.length<i.length?-1:1}function er(n,e){if(Ne(n)!==Ne(e))return!1;for(let t=n.pieceNum_,i=e.pieceNum_;t<=n.pieces_.length;t++,i++)if(n.pieces_[t]!==e.pieces_[i])return!1;return!0}function J(n,e){let t=n.pieceNum_,i=e.pieceNum_;if(Ne(n)>Ne(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[i])return!1;++t,++i}return!0}var ns=class{constructor(e,t){this.errorPrefix_=t,this.parts_=Ft(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=Et(this.parts_[i]);ba(this)}};function wu(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Et(e),ba(n)}function Eu(n){let e=n.parts_.pop();n.byteLength_-=Et(e),n.parts_.length>0&&(n.byteLength_-=1)}function ba(n){if(n.byteLength_>Lo)throw new Error(n.errorPrefix_+"has a key path longer than "+Lo+" bytes ("+n.byteLength_+").");if(n.parts_.length>Fo)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Fo+") or object contains a cycle "+Be(n))}function Be(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}var is=class n extends An{constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let i=!document[e];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}static getInstance(){return new n}getInitialEvent(e){return f(e==="visible","Unknown event type: "+e),[this.visible_]}};var At=1e3,Cu=60*5*1e3,Wo=30*1e3,Tu=1.3,Iu=3e4,Su="server_kill",Uo=3,tr=(()=>{class n extends bn{constructor(t,i,s,r,o,a,l,c){if(super(),this.repoInfo_=t,this.applicationId_=i,this.onDataUpdate_=s,this.onConnectStatus_=r,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=l,this.authOverride_=c,this.id=n.nextPersistentConnectionId_++,this.log_=Yt("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=At,this.maxReconnectDelay_=Cu,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c&&!le())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");is.getInstance().on("visible",this.onVisible_,this),t.host.indexOf("fblocal")===-1&&kn.getInstance().on("online",this.onOnline_,this)}sendRequest(t,i,s){let r=++this.requestNumber_,o={r,a:t,b:i};this.log_(P(o)),f(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),s&&(this.requestCBHash_[r]=s)}get(t){this.initConnection_();let i=new D,r={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:a=>{let l=a.d;a.s==="ok"?i.resolve(l):i.reject(l)}};this.outstandingGets_.push(r),this.outstandingGetCount_++;let o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),i.promise}listen(t,i,s,r){this.initConnection_();let o=t._queryIdentifier,a=t._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),f(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),f(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");let l={onComplete:r,hashFn:i,query:t,tag:s};this.listens.get(a).set(o,l),this.connected_&&this.sendListen_(l)}sendGet_(t){let i=this.outstandingGets_[t];this.sendRequest("g",i.request,s=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),i.onComplete&&i.onComplete(s)})}sendListen_(t){let i=t.query,s=i._path.toString(),r=i._queryIdentifier;this.log_("Listen on "+s+" for "+r);let o={p:s},a="q";t.tag&&(o.q=i._queryObject,o.t=t.tag),o.h=t.hashFn(),this.sendRequest(a,o,l=>{let c=l.d,u=l.s;n.warnOnListenWarnings_(c,i),(this.listens.get(s)&&this.listens.get(s).get(r))===t&&(this.log_("listen response",l),u!=="ok"&&this.removeListen_(s,r),t.onComplete&&t.onComplete(u,c))})}static warnOnListenWarnings_(t,i){if(t&&typeof t=="object"&&X(t,"w")){let s=Te(t,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){let r='".indexOn": "'+i._queryParams.getIndex().toString()+'"',o=i._path.toString();F(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${r} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&t.length===40||eo(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Wo)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let t=this.authToken_,i=Jr(t)?"auth":"gauth",s={cred:t};this.authOverride_===null?s.noauth=!0:typeof this.authOverride_=="object"&&(s.authvar=this.authOverride_),this.sendRequest(i,s,r=>{let o=r.s,a=r.d||"error";this.authToken_===t&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{let i=t.s,s=t.d||"error";i==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(i,s)})}unlisten(t,i){let s=t._path.toString(),r=t._queryIdentifier;this.log_("Unlisten called for "+s+" "+r),f(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(s,r)&&this.connected_&&this.sendUnlisten_(s,r,t._queryObject,i)}sendUnlisten_(t,i,s,r){this.log_("Unlisten on "+t+" for "+i);let o={p:t},a="n";r&&(o.q=s,o.t=r),this.sendRequest(a,o)}onDisconnectPut(t,i,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,i,s):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:i,onComplete:s})}onDisconnectMerge(t,i,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,i,s):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:i,onComplete:s})}onDisconnectCancel(t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:i})}sendOnDisconnect_(t,i,s,r){let o={p:i,d:s};this.log_("onDisconnect "+t,o),this.sendRequest(t,o,a=>{r&&setTimeout(()=>{r(a.s,a.d)},Math.floor(0))})}put(t,i,s,r){this.putInternal("p",t,i,s,r)}merge(t,i,s,r){this.putInternal("m",t,i,s,r)}putInternal(t,i,s,r,o){this.initConnection_();let a={p:i,d:s};o!==void 0&&(a.h=o),this.outstandingPuts_.push({action:t,request:a,onComplete:r}),this.outstandingPutCount_++;let l=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(l):this.log_("Buffering put: "+i)}sendPut_(t){let i=this.outstandingPuts_[t].action,s=this.outstandingPuts_[t].request,r=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(i,s,o=>{this.log_(i+" response",o),delete this.outstandingPuts_[t],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),r&&r(o.s,o.d)})}reportStats(t){if(this.connected_){let i={c:t};this.log_("reportStats",i),this.sendRequest("s",i,s=>{if(s.s!=="ok"){let o=s.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+P(t));let i=t.r,s=this.requestCBHash_[i];s&&(delete this.requestCBHash_[i],s(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,i){this.log_("handleServerMessage",t,i),t==="d"?this.onDataUpdate_(i.p,i.d,!1,i.t):t==="m"?this.onDataUpdate_(i.p,i.d,!0,i.t):t==="c"?this.onListenRevoked_(i.p,i.q):t==="ac"?this.onAuthRevoked_(i.s,i.d):t==="apc"?this.onAppCheckRevoked_(i.s,i.d):t==="sd"?this.onSecurityDebugPacket_(i):qi("Unrecognized action received from server: "+P(t)+`
Are you using the latest client?`)}onReady_(t,i){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(t),this.lastSessionId=i,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){f(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=At,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=At,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>Iu&&(this.reconnectDelay_=At),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let t=new Date().getTime()-this.lastConnectionAttemptTime_,i=Math.max(0,this.reconnectDelay_-t);i=Math.random()*i,this.log_("Trying to reconnect in "+i+"ms"),this.scheduleConnect_(i),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Tu)}this.onConnectStatus_(!1)}establishConnection_(){return oe(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let t=this.onDataMessage_.bind(this),i=this.onReady_.bind(this),s=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+n.nextConnectionId_++,o=this.lastSessionId,a=!1,l=null,c=function(){l?l.close():(a=!0,s())},u=function(d){f(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(d)};this.realtime_={close:c,sendRequest:u};let h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[d,p]=yield Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);a?O("getToken() completed but was canceled"):(O("getToken() completed. Creating connection."),this.authToken_=d&&d.accessToken,this.appCheckToken_=p&&p.token,l=new ts(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,i,s,_=>{F(_+" ("+this.repoInfo_.toString()+")"),this.interrupt(Su)},o))}catch(d){this.log_("Failed to get token: "+d),a||(this.repoInfo_.nodeAdmin&&F(d),c())}}})}interrupt(t){O("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){O("Resuming connection for reason: "+t),delete this.interruptReasons_[t],dn(this.interruptReasons_)&&(this.reconnectDelay_=At,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){let i=t-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:i})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){let i=this.outstandingPuts_[t];i&&"h"in i.request&&i.queued&&(i.onComplete&&i.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(t,i){let s;i?s=i.map(o=>Xs(o)).join("$"):s="default";let r=this.removeListen_(t,s);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(t,i){let s=new I(t).toString(),r;if(this.listens.has(s)){let o=this.listens.get(s);r=o.get(i),o.delete(i),o.size===0&&this.listens.delete(s)}else r=void 0;return r}onAuthRevoked_(t,i){O("Auth token revoked: "+t+"/"+i),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(t==="invalid_token"||t==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Uo&&(this.reconnectDelay_=Wo,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,i){O("App check token revoked: "+t+"/"+i),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(t==="invalid_token"||t==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Uo&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let t of this.listens.values())for(let i of t.values())this.sendListen_(i);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){let t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){let t={},i="js";le()&&(this.repoInfo_.nodeAdmin?i="admin_node":i="node"),t["sdk."+i+"."+Qs.replace(/\./g,"-")]=1,vi()?t["framework.cordova"]=1:Yr()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){let t=kn.getInstance().currentlyOnline();return dn(this.interruptReasons_)&&t}}n.nextPersistentConnectionId_=0,n.nextConnectionId_=0;return n})(),w=class n{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new n(e,t)}};var rt=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let i=new w(Re,e),s=new w(Re,t);return this.compare(i,s)!==0}minPost(){return w.MIN}};var Cn,Rn=class extends rt{static get __EMPTY_NODE(){return Cn}static set __EMPTY_NODE(e){Cn=e}compare(e,t){return Ge(e.name,t.name)}isDefinedOn(e){throw Qe("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return w.MIN}maxPost(){return new w(me,Cn)}makePost(e,t){return f(typeof e=="string","KeyIndex indexValue must always be a string."),new w(e,Cn)}toString(){return".key"}},he=new Rn;var it=class{constructor(e,t,i,s,r=null){this.isReverse_=s,this.resultGenerator_=r,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?i(e.key,t):1,s&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},se=(()=>{class n{constructor(t,i,s,r,o){this.key=t,this.value=i,this.color=s??n.RED,this.left=r??ee.EMPTY_NODE,this.right=o??ee.EMPTY_NODE}copy(t,i,s,r,o){return new n(t??this.key,i??this.value,s??this.color,r??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,i,s){let r=this,o=s(t,r.key);return o<0?r=r.copy(null,null,null,r.left.insert(t,i,s),null):o===0?r=r.copy(null,i,null,null,null):r=r.copy(null,null,null,null,r.right.insert(t,i,s)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return ee.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,i){let s,r;if(s=this,i(t,s.key)<0)!s.left.isEmpty()&&!s.left.isRed_()&&!s.left.left.isRed_()&&(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(t,i),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),!s.right.isEmpty()&&!s.right.isRed_()&&!s.right.left.isRed_()&&(s=s.moveRedRight_()),i(t,s.key)===0){if(s.right.isEmpty())return ee.EMPTY_NODE;r=s.right.min_(),s=s.copy(r.key,r.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(t,i))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){let t=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,i)}checkMaxDepth_(){let t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})(),ss=class{copy(e,t,i,s,r){return this}insert(e,t,i){return new se(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},ee=class n{constructor(e,t=n.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new n(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,se.BLACK,null,null))}remove(e){return new n(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,se.BLACK,null,null))}get(e){let t,i=this.root_;for(;!i.isEmpty();){if(t=this.comparator_(e,i.key),t===0)return i.value;t<0?i=i.left:t>0&&(i=i.right)}return null}getPredecessorKey(e){let t,i=this.root_,s=null;for(;!i.isEmpty();)if(t=this.comparator_(e,i.key),t===0){if(i.left.isEmpty())return s?s.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}else t<0?i=i.left:t>0&&(s=i,i=i.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new it(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new it(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new it(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new it(this.root_,null,this.comparator_,!0,e)}};ee.EMPTY_NODE=new ss;function bu(n,e){return Ge(n.name,e.name)}function nr(n,e){return Ge(n,e)}var rs;function Au(n){rs=n}var Aa=function(n){return typeof n=="number"?"number:"+la(n):"string:"+n},ka=function(n){if(n.isLeafNode()){let e=n.val();f(typeof e=="string"||typeof e=="number"||typeof e=="object"&&X(e,".sv"),"Priority must be a string or number.")}else f(n===rs||n.isEmpty(),"priority of unexpected type.");f(n===rs||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var Bo,ot=(()=>{class n{constructor(t,i=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=i,this.lazyHash_=null,f(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),ka(this.priorityNode_)}static set __childrenNodeConstructor(t){Bo=t}static get __childrenNodeConstructor(){return Bo}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new n(this.value_,t)}getImmediateChild(t){return t===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return v(t)?this:y(t)===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,i){return null}updateImmediateChild(t,i){return t===".priority"?this.updatePriority(i):i.isEmpty()&&t!==".priority"?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,i).updatePriority(this.priorityNode_)}updateChild(t,i){let s=y(t);return s===null?i:i.isEmpty()&&s!==".priority"?this:(f(s!==".priority"||Ne(t)===1,".priority must be the last token in a path"),this.updateImmediateChild(s,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(b(t),i)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,i){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+Aa(this.priorityNode_.val())+":");let i=typeof this.value_;t+=i+":",i==="number"?t+=la(this.value_):t+=this.value_,this.lazyHash_=ra(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===n.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof n.__childrenNodeConstructor?-1:(f(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){let i=typeof t.value_,s=typeof this.value_,r=n.VALUE_TYPE_ORDER.indexOf(i),o=n.VALUE_TYPE_ORDER.indexOf(s);return f(r>=0,"Unknown leaf type: "+i),f(o>=0,"Unknown leaf type: "+s),r===o?s==="object"?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-r}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){let i=t;return this.value_===i.value_&&this.priorityNode_.equals(i.priorityNode_)}else return!1}}n.VALUE_TYPE_ORDER=["object","boolean","number","string"];return n})(),Ra,Na;function ku(n){Ra=n}function Ru(n){Na=n}var os=class extends rt{compare(e,t){let i=e.node.getPriority(),s=t.node.getPriority(),r=i.compareTo(s);return r===0?Ge(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return w.MIN}maxPost(){return new w(me,new ot("[PRIORITY-POST]",Na))}makePost(e,t){let i=Ra(e);return new w(t,new ot("[PRIORITY-POST]",i))}toString(){return".priority"}},A=new os;var Nu=Math.log(2),as=class{constructor(e){let t=r=>parseInt(Math.log(r)/Nu,10),i=r=>parseInt(Array(r+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;let s=i(this.count);this.bits_=e+1&s}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}},Nn=function(n,e,t,i){n.sort(e);let s=function(l,c){let u=c-l,h,d;if(u===0)return null;if(u===1)return h=n[l],d=t?t(h):h,new se(d,h.node,se.BLACK,null,null);{let p=parseInt(u/2,10)+l,_=s(l,p),E=s(p+1,c);return h=n[p],d=t?t(h):h,new se(d,h.node,se.BLACK,_,E)}},r=function(l){let c=null,u=null,h=n.length,d=function(_,E){let S=h-_,H=h;h-=_;let G=s(S+1,H),k=n[S],ne=t?t(k):k;p(new se(ne,k.node,E,null,G))},p=function(_){c?(c.left=_,c=_):(u=_,c=_)};for(let _=0;_<l.count;++_){let E=l.nextBitIsOne(),S=Math.pow(2,l.count-(_+1));E?d(S,se.BLACK):(d(S,se.BLACK),d(S,se.RED))}return u},o=new as(n.length),a=r(o);return new ee(i||e,a)};var Vi,tt={},at=class n{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return f(tt&&A,"ChildrenNode.ts has not been loaded"),Vi=Vi||new n({".priority":tt},{".priority":A}),Vi}get(e){let t=Te(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof ee?t:null}hasIndex(e){return X(this.indexSet_,e.toString())}addIndex(e,t){f(e!==he,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let i=[],s=!1,r=t.getIterator(w.Wrap),o=r.getNext();for(;o;)s=s||e.isDefinedOn(o.node),i.push(o),o=r.getNext();let a;s?a=Nn(i,e.getCompare()):a=tt;let l=e.toString(),c=Object.assign({},this.indexSet_);c[l]=e;let u=Object.assign({},this.indexes_);return u[l]=a,new n(u,c)}addToIndexes(e,t){let i=wt(this.indexes_,(s,r)=>{let o=Te(this.indexSet_,r);if(f(o,"Missing index implementation for "+r),s===tt)if(o.isDefinedOn(e.node)){let a=[],l=t.getIterator(w.Wrap),c=l.getNext();for(;c;)c.name!==e.name&&a.push(c),c=l.getNext();return a.push(e),Nn(a,o.getCompare())}else return tt;else{let a=t.get(e.name),l=s;return a&&(l=l.remove(new w(e.name,a))),l.insert(e,e.node)}});return new n(i,this.indexSet_)}removeFromIndexes(e,t){let i=wt(this.indexes_,s=>{if(s===tt)return s;{let r=t.get(e.name);return r?s.remove(new w(e.name,r)):s}});return new n(i,this.indexSet_)}};var kt,m=(()=>{class n{constructor(t,i,s){this.children_=t,this.priorityNode_=i,this.indexMap_=s,this.lazyHash_=null,this.priorityNode_&&ka(this.priorityNode_),this.children_.isEmpty()&&f(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return kt||(kt=new n(new ee(nr),null,at.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||kt}updatePriority(t){return this.children_.isEmpty()?this:new n(this.children_,t,this.indexMap_)}getImmediateChild(t){if(t===".priority")return this.getPriority();{let i=this.children_.get(t);return i===null?kt:i}}getChild(t){let i=y(t);return i===null?this:this.getImmediateChild(i).getChild(b(t))}hasChild(t){return this.children_.get(t)!==null}updateImmediateChild(t,i){if(f(i,"We should always be passing snapshot nodes"),t===".priority")return this.updatePriority(i);{let s=new w(t,i),r,o;i.isEmpty()?(r=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(s,this.children_)):(r=this.children_.insert(t,i),o=this.indexMap_.addToIndexes(s,this.children_));let a=r.isEmpty()?kt:this.priorityNode_;return new n(r,a,o)}}updateChild(t,i){let s=y(t);if(s===null)return i;{f(y(t)!==".priority"||Ne(t)===1,".priority must be the last token in a path");let r=this.getImmediateChild(s).updateChild(b(t),i);return this.updateImmediateChild(s,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;let i={},s=0,r=0,o=!0;if(this.forEachChild(A,(a,l)=>{i[a]=l.val(t),s++,o&&n.INTEGER_REGEXP_.test(a)?r=Math.max(r,Number(a)):o=!1}),!t&&o&&r<2*s){let a=[];for(let l in i)a[l]=i[l];return a}else return t&&!this.getPriority().isEmpty()&&(i[".priority"]=this.getPriority().val()),i}hash(){if(this.lazyHash_===null){let t="";this.getPriority().isEmpty()||(t+="priority:"+Aa(this.getPriority().val())+":"),this.forEachChild(A,(i,s)=>{let r=s.hash();r!==""&&(t+=":"+i+":"+r)}),this.lazyHash_=t===""?"":ra(t)}return this.lazyHash_}getPredecessorChildName(t,i,s){let r=this.resolveIndex_(s);if(r){let o=r.getPredecessorKey(new w(t,i));return o?o.name:null}else return this.children_.getPredecessorKey(t)}getFirstChildName(t){let i=this.resolveIndex_(t);if(i){let s=i.minKey();return s&&s.name}else return this.children_.minKey()}getFirstChild(t){let i=this.getFirstChildName(t);return i?new w(i,this.children_.get(i)):null}getLastChildName(t){let i=this.resolveIndex_(t);if(i){let s=i.maxKey();return s&&s.name}else return this.children_.maxKey()}getLastChild(t){let i=this.getLastChildName(t);return i?new w(i,this.children_.get(i)):null}forEachChild(t,i){let s=this.resolveIndex_(t);return s?s.inorderTraversal(r=>i(r.name,r.node)):this.children_.inorderTraversal(i)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,i){let s=this.resolveIndex_(i);if(s)return s.getIteratorFrom(t,r=>r);{let r=this.children_.getIteratorFrom(t.name,w.Wrap),o=r.peek();for(;o!=null&&i.compare(o,t)<0;)r.getNext(),o=r.peek();return r}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,i){let s=this.resolveIndex_(i);if(s)return s.getReverseIteratorFrom(t,r=>r);{let r=this.children_.getReverseIteratorFrom(t.name,w.Wrap),o=r.peek();for(;o!=null&&i.compare(o,t)>0;)r.getNext(),o=r.peek();return r}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Xt?-1:0}withIndex(t){if(t===he||this.indexMap_.hasIndex(t))return this;{let i=this.indexMap_.addIndex(t,this.children_);return new n(this.children_,this.priorityNode_,i)}}isIndexed(t){return t===he||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{let i=t;if(this.getPriority().equals(i.getPriority()))if(this.children_.count()===i.children_.count()){let s=this.getIterator(A),r=i.getIterator(A),o=s.getNext(),a=r.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=s.getNext(),a=r.getNext()}return o===null&&a===null}else return!1;else return!1}}resolveIndex_(t){return t===he?null:this.indexMap_.get(t.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})(),ls=class extends m{constructor(){super(new ee(nr),m.EMPTY_NODE,at.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return m.EMPTY_NODE}isEmpty(){return!1}},Xt=new ls;Object.defineProperties(w,{MIN:{value:new w(Re,m.EMPTY_NODE)},MAX:{value:new w(me,Xt)}});Rn.__EMPTY_NODE=m.EMPTY_NODE;ot.__childrenNodeConstructor=m;Au(Xt);Ru(Xt);var Pu=!0;function N(n,e=null){if(n===null)return m.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),f(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){let t=n;return new ot(t,N(e))}if(!(n instanceof Array)&&Pu){let t=[],i=!1;if(M(n,(o,a)=>{if(o.substring(0,1)!=="."){let l=N(a);l.isEmpty()||(i=i||!l.getPriority().isEmpty(),t.push(new w(o,l)))}}),t.length===0)return m.EMPTY_NODE;let r=Nn(t,bu,o=>o.name,nr);if(i){let o=Nn(t,A.getCompare());return new m(r,N(e),new at({".priority":o},{".priority":A}))}else return new m(r,N(e),at.Default)}else{let t=m.EMPTY_NODE;return M(n,(i,s)=>{if(X(n,i)&&i.substring(0,1)!=="."){let r=N(s);(r.isLeafNode()||!r.isEmpty())&&(t=t.updateImmediateChild(i,r))}}),t.updatePriority(N(e))}}ku(N);var Lt=class extends rt{constructor(e){super(),this.indexPath_=e,f(!v(e)&&y(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let i=this.extractChild(e.node),s=this.extractChild(t.node),r=i.compareTo(s);return r===0?Ge(e.name,t.name):r}makePost(e,t){let i=N(e),s=m.EMPTY_NODE.updateChild(this.indexPath_,i);return new w(t,s)}maxPost(){let e=m.EMPTY_NODE.updateChild(this.indexPath_,Xt);return new w(me,e)}toString(){return Ft(this.indexPath_,0).join("/")}};var cs=class extends rt{compare(e,t){let i=e.node.compareTo(t.node);return i===0?Ge(e.name,t.name):i}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return w.MIN}maxPost(){return w.MAX}makePost(e,t){let i=N(e);return new w(t,i)}toString(){return".value"}},ir=new cs;function Pa(n){return{type:"value",snapshotNode:n}}function lt(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function Wt(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function Ut(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function xu(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}var Bt=class{constructor(e){this.index_=e}updateChild(e,t,i,s,r,o){f(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let a=e.getImmediateChild(t);return a.getChild(s).equals(i.getChild(s))&&a.isEmpty()===i.isEmpty()||(o!=null&&(i.isEmpty()?e.hasChild(t)?o.trackChildChange(Wt(t,a)):f(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(lt(t,i)):o.trackChildChange(Ut(t,i,a))),e.isLeafNode()&&i.isEmpty())?e:e.updateImmediateChild(t,i).withIndex(this.index_)}updateFullNode(e,t,i){return i!=null&&(e.isLeafNode()||e.forEachChild(A,(s,r)=>{t.hasChild(s)||i.trackChildChange(Wt(s,r))}),t.isLeafNode()||t.forEachChild(A,(s,r)=>{if(e.hasChild(s)){let o=e.getImmediateChild(s);o.equals(r)||i.trackChildChange(Ut(s,r,o))}else i.trackChildChange(lt(s,r))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?m.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}};var Pn=class n{constructor(e){this.indexedFilter_=new Bt(e.getIndex()),this.index_=e.getIndex(),this.startPost_=n.getStartPost_(e),this.endPost_=n.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,i=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&i}updateChild(e,t,i,s,r,o){return this.matches(new w(t,i))||(i=m.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,i,s,r,o)}updateFullNode(e,t,i){t.isLeafNode()&&(t=m.EMPTY_NODE);let s=t.withIndex(this.index_);s=s.updatePriority(m.EMPTY_NODE);let r=this;return t.forEachChild(A,(o,a)=>{r.matches(new w(o,a))||(s=s.updateImmediateChild(o,m.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}};var us=class{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{let i=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?i<=0:i<0},this.withinEndPost=t=>{let i=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?i<=0:i<0},this.rangedFilter_=new Pn(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,i,s,r,o){return this.rangedFilter_.matches(new w(t,i))||(i=m.EMPTY_NODE),e.getImmediateChild(t).equals(i)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,i,s,r,o):this.fullLimitUpdateChild_(e,t,i,r,o)}updateFullNode(e,t,i){let s;if(t.isLeafNode()||t.isEmpty())s=m.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){s=m.EMPTY_NODE.withIndex(this.index_);let r;this.reverse_?r=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):r=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;r.hasNext()&&o<this.limit_;){let a=r.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))s=s.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{s=t.withIndex(this.index_),s=s.updatePriority(m.EMPTY_NODE);let r;this.reverse_?r=s.getReverseIterator(this.index_):r=s.getIterator(this.index_);let o=0;for(;r.hasNext();){let a=r.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:s=s.updateImmediateChild(a.name,m.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,i,s,r){let o;if(this.reverse_){let h=this.index_.getCompare();o=(d,p)=>h(p,d)}else o=this.index_.getCompare();let a=e;f(a.numChildren()===this.limit_,"");let l=new w(t,i),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),u=this.rangedFilter_.matches(l);if(a.hasChild(t)){let h=a.getImmediateChild(t),d=s.getChildAfterChild(this.index_,c,this.reverse_);for(;d!=null&&(d.name===t||a.hasChild(d.name));)d=s.getChildAfterChild(this.index_,d,this.reverse_);let p=d==null?1:o(d,l);if(u&&!i.isEmpty()&&p>=0)return r?.trackChildChange(Ut(t,i,h)),a.updateImmediateChild(t,i);{r?.trackChildChange(Wt(t,h));let E=a.updateImmediateChild(t,m.EMPTY_NODE);return d!=null&&this.rangedFilter_.matches(d)?(r?.trackChildChange(lt(d.name,d.node)),E.updateImmediateChild(d.name,d.node)):E}}else return i.isEmpty()?e:u&&o(c,l)>=0?(r!=null&&(r.trackChildChange(Wt(c.name,c.node)),r.trackChildChange(lt(t,i))),a.updateImmediateChild(t,i).updateImmediateChild(c.name,m.EMPTY_NODE)):e}};var Vt=class n{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=A}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return f(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return f(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Re}hasEnd(){return this.endSet_}getIndexEndValue(){return f(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return f(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:me}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return f(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===A}copy(){let e=new n;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}};function Du(n){return n.loadsAllData()?new Bt(n.getIndex()):n.hasLimit()?new us(n):new Pn(n)}function Ou(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function Mu(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function hs(n,e,t){let i=n.copy();return i.startSet_=!0,e===void 0&&(e=null),i.indexStartValue_=e,t!=null?(i.startNameSet_=!0,i.indexStartName_=t):(i.startNameSet_=!1,i.indexStartName_=""),i}function Fu(n,e,t){let i;return n.index_===he||t?i=hs(n,e,t):i=hs(n,e,me),i.startAfterSet_=!0,i}function ds(n,e,t){let i=n.copy();return i.endSet_=!0,e===void 0&&(e=null),i.indexEndValue_=e,t!==void 0?(i.endNameSet_=!0,i.indexEndName_=t):(i.endNameSet_=!1,i.indexEndName_=""),i}function Lu(n,e,t){let i;return n.index_===he||t?i=ds(n,e,t):i=ds(n,e,Re),i.endBeforeSet_=!0,i}function Yn(n,e){let t=n.copy();return t.index_=e,t}function Vo(n){let e={};if(n.isDefault())return e;let t;if(n.index_===A?t="$priority":n.index_===ir?t="$value":n.index_===he?t="$key":(f(n.index_ instanceof Lt,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=P(t),n.startSet_){let i=n.startAfterSet_?"startAfter":"startAt";e[i]=P(n.indexStartValue_),n.startNameSet_&&(e[i]+=","+P(n.indexStartName_))}if(n.endSet_){let i=n.endBeforeSet_?"endBefore":"endAt";e[i]=P(n.indexEndValue_),n.endNameSet_&&(e[i]+=","+P(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function jo(n){let e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==A&&(e.i=n.index_.toString()),e}var fs=class n extends bn{constructor(e,t,i,s){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=i,this.appCheckTokenProvider_=s,this.log_=Yt("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(f(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,i,s){let r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);let o=n.getListenId_(e,i),a={};this.listens_[o]=a;let l=Vo(e._queryParams);this.restRequest_(r+".json",l,(c,u)=>{let h=u;if(c===404&&(h=null,c=null),c===null&&this.onDataUpdate_(r,h,!1,i),Te(this.listens_,o)===a){let d;c?c===401?d="permission_denied":d="rest_error:"+c:d="ok",s(d,null)}})}unlisten(e,t){let i=n.getListenId_(e,t);delete this.listens_[i]}get(e){let t=Vo(e._queryParams),i=e._path.toString(),s=new D;return this.restRequest_(i+".json",t,(r,o)=>{let a=o;r===404&&(a=null,r=null),r===null?(this.onDataUpdate_(i,a,!1,null),s.resolve(a)):s.reject(new Error(a))}),s.promise}refreshAuthToken(e){}restRequest_(e,t={},i){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,r])=>{s&&s.accessToken&&(t.auth=s.accessToken),r&&r.token&&(t.ac=r.token);let o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+to(t);this.log_("Sending REST request for "+o);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(i&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=hn(a.responseText)}catch{F("Failed to parse JSON response for "+o+": "+a.responseText)}i(null,l)}else a.status!==401&&a.status!==404&&F("Got unsuccessful REST response for "+o+" Status: "+a.status),i(a.status);i=null}},a.open("GET",o,!0),a.send()})}};var ps=class{constructor(){this.rootNode_=m.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}};function xn(){return{value:null,children:new Map}}function pt(n,e,t){if(v(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{let i=y(e);n.children.has(i)||n.children.set(i,xn());let s=n.children.get(i);e=b(e),pt(s,e,t)}}function _s(n,e){if(v(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{let t=n.value;return n.value=null,t.forEachChild(A,(i,s)=>{pt(n,new I(i),s)}),_s(n,e)}}else if(n.children.size>0){let t=y(e);return e=b(e),n.children.has(t)&&_s(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function gs(n,e,t){n.value!==null?t(e,n.value):Wu(n,(i,s)=>{let r=new I(e.toString()+"/"+i);gs(s,r,t)})}function Wu(n,e){n.children.forEach((t,i)=>{e(i,t)})}var ms=class{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&M(this.last_,(i,s)=>{t[i]=t[i]-s}),this.last_=e,t}};var Ho=10*1e3,Uu=30*1e3,Bu=5*60*1e3,ys=class{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new ms(e);let i=Ho+(Uu-Ho)*Math.random();Nt(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){let e=this.statsListener_.get(),t={},i=!1;M(e,(s,r)=>{r>0&&X(this.statsToReport_,s)&&(t[s]=r,i=!0)}),i&&this.server_.reportStats(t),Nt(this.reportStats_.bind(this),Math.floor(Math.random()*2*Bu))}};var ue=function(n){return n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",n}(ue||{});function sr(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function rr(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function or(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}var vs=class n{constructor(e,t,i){this.path=e,this.affectedTree=t,this.revert=i,this.type=ue.ACK_USER_WRITE,this.source=sr()}operationForChild(e){if(v(this.path)){if(this.affectedTree.value!=null)return f(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new I(e));return new n(T(),t,this.revert)}}else return f(y(this.path)===e,"operationForChild called for unrelated child."),new n(b(this.path),this.affectedTree,this.revert)}};var Dn=class n{constructor(e,t){this.source=e,this.path=t,this.type=ue.LISTEN_COMPLETE}operationForChild(e){return v(this.path)?new n(this.source,T()):new n(this.source,b(this.path))}};var ct=class n{constructor(e,t,i){this.source=e,this.path=t,this.snap=i,this.type=ue.OVERWRITE}operationForChild(e){return v(this.path)?new n(this.source,T(),this.snap.getImmediateChild(e)):new n(this.source,b(this.path),this.snap)}};var jt=class n{constructor(e,t,i){this.source=e,this.path=t,this.children=i,this.type=ue.MERGE}operationForChild(e){if(v(this.path)){let t=this.children.subtree(new I(e));return t.isEmpty()?null:t.value?new ct(this.source,T(),t.value):new n(this.source,T(),t)}else return f(y(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new n(this.source,b(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var fe=class{constructor(e,t,i){this.node_=e,this.fullyInitialized_=t,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(v(e))return this.isFullyInitialized()&&!this.filtered_;let t=y(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}};var ws=class{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}};function Vu(n,e,t,i){let s=[],r=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&r.push(xu(o.childName,o.snapshotNode))}),Rt(n,s,"child_removed",e,i,t),Rt(n,s,"child_added",e,i,t),Rt(n,s,"child_moved",r,i,t),Rt(n,s,"child_changed",e,i,t),Rt(n,s,"value",e,i,t),s}function Rt(n,e,t,i,s,r){let o=i.filter(a=>a.type===t);o.sort((a,l)=>Hu(n,a,l)),o.forEach(a=>{let l=ju(n,a,r);s.forEach(c=>{c.respondsTo(a.type)&&e.push(c.createEvent(l,n.query_))})})}function ju(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function Hu(n,e,t){if(e.childName==null||t.childName==null)throw Qe("Should only compare child_ events.");let i=new w(e.childName,e.snapshotNode),s=new w(t.childName,t.snapshotNode);return n.index_.compare(i,s)}function Xn(n,e){return{eventCache:n,serverCache:e}}function xt(n,e,t,i){return Xn(new fe(e,t,i),n.serverCache)}function xa(n,e,t,i){return Xn(n.eventCache,new fe(e,t,i))}function On(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function He(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}var ji,Gu=()=>(ji||(ji=new ee(jc)),ji),B=class n{constructor(e,t=Gu()){this.value=e,this.children=t}static fromObject(e){let t=new n(null);return M(e,(i,s)=>{t=t.set(new I(i),s)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:T(),value:this.value};if(v(e))return null;{let i=y(e),s=this.children.get(i);if(s!==null){let r=s.findRootMostMatchingPathAndValue(b(e),t);return r!=null?{path:R(new I(i),r.path),value:r.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(v(e))return this;{let t=y(e),i=this.children.get(t);return i!==null?i.subtree(b(e)):new n(null)}}set(e,t){if(v(e))return new n(t,this.children);{let i=y(e),r=(this.children.get(i)||new n(null)).set(b(e),t),o=this.children.insert(i,r);return new n(this.value,o)}}remove(e){if(v(e))return this.children.isEmpty()?new n(null):new n(null,this.children);{let t=y(e),i=this.children.get(t);if(i){let s=i.remove(b(e)),r;return s.isEmpty()?r=this.children.remove(t):r=this.children.insert(t,s),this.value===null&&r.isEmpty()?new n(null):new n(this.value,r)}else return this}}get(e){if(v(e))return this.value;{let t=y(e),i=this.children.get(t);return i?i.get(b(e)):null}}setTree(e,t){if(v(e))return t;{let i=y(e),r=(this.children.get(i)||new n(null)).setTree(b(e),t),o;return r.isEmpty()?o=this.children.remove(i):o=this.children.insert(i,r),new n(this.value,o)}}fold(e){return this.fold_(T(),e)}fold_(e,t){let i={};return this.children.inorderTraversal((s,r)=>{i[s]=r.fold_(R(e,s),t)}),t(e,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,T(),t)}findOnPath_(e,t,i){let s=this.value?i(t,this.value):!1;if(s)return s;if(v(e))return null;{let r=y(e),o=this.children.get(r);return o?o.findOnPath_(b(e),R(t,r),i):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,T(),t)}foreachOnPath_(e,t,i){if(v(e))return this;{this.value&&i(t,this.value);let s=y(e),r=this.children.get(s);return r?r.foreachOnPath_(b(e),R(t,s),i):new n(null)}}foreach(e){this.foreach_(T(),e)}foreach_(e,t){this.children.inorderTraversal((i,s)=>{s.foreach_(R(e,i),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,i)=>{i.value&&e(t,i.value)})}};var re=class n{constructor(e){this.writeTree_=e}static empty(){return new n(new B(null))}};function Dt(n,e,t){if(v(e))return new re(new B(t));{let i=n.writeTree_.findRootMostValueAndPath(e);if(i!=null){let s=i.path,r=i.value,o=U(s,e);return r=r.updateChild(o,t),new re(n.writeTree_.set(s,r))}else{let s=new B(t),r=n.writeTree_.setTree(e,s);return new re(r)}}}function Es(n,e,t){let i=n;return M(t,(s,r)=>{i=Dt(i,R(e,s),r)}),i}function Go(n,e){if(v(e))return re.empty();{let t=n.writeTree_.setTree(e,new B(null));return new re(t)}}function Cs(n,e){return Ke(n,e)!=null}function Ke(n,e){let t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(U(t.path,e)):null}function Ko(n){let e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(A,(i,s)=>{e.push(new w(i,s))}):n.writeTree_.children.inorderTraversal((i,s)=>{s.value!=null&&e.push(new w(i,s.value))}),e}function Ae(n,e){if(v(e))return n;{let t=Ke(n,e);return t!=null?new re(new B(t)):new re(n.writeTree_.subtree(e))}}function Ts(n){return n.writeTree_.isEmpty()}function ut(n,e){return Da(T(),n.writeTree_,e)}function Da(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let i=null;return e.children.inorderTraversal((s,r)=>{s===".priority"?(f(r.value!==null,"Priority writes must always be leaf nodes"),i=r.value):t=Da(R(n,s),r,t)}),!t.getChild(n).isEmpty()&&i!==null&&(t=t.updateChild(R(n,".priority"),i)),t}}function Zn(n,e){return La(e,n)}function Ku(n,e,t,i,s){f(i>n.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),n.allWrites.push({path:e,snap:t,writeId:i,visible:s}),s&&(n.visibleWrites=Dt(n.visibleWrites,e,t)),n.lastWriteId=i}function $u(n,e,t,i){f(i>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:i,visible:!0}),n.visibleWrites=Es(n.visibleWrites,e,t),n.lastWriteId=i}function zu(n,e){for(let t=0;t<n.allWrites.length;t++){let i=n.allWrites[t];if(i.writeId===e)return i}return null}function qu(n,e){let t=n.allWrites.findIndex(a=>a.writeId===e);f(t>=0,"removeWrite called with nonexistent writeId.");let i=n.allWrites[t];n.allWrites.splice(t,1);let s=i.visible,r=!1,o=n.allWrites.length-1;for(;s&&o>=0;){let a=n.allWrites[o];a.visible&&(o>=t&&Qu(a,i.path)?s=!1:J(i.path,a.path)&&(r=!0)),o--}if(s){if(r)return Yu(n),!0;if(i.snap)n.visibleWrites=Go(n.visibleWrites,i.path);else{let a=i.children;M(a,l=>{n.visibleWrites=Go(n.visibleWrites,R(i.path,l))})}return!0}else return!1}function Qu(n,e){if(n.snap)return J(n.path,e);for(let t in n.children)if(n.children.hasOwnProperty(t)&&J(R(n.path,t),e))return!0;return!1}function Yu(n){n.visibleWrites=Oa(n.allWrites,Xu,T()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function Xu(n){return n.visible}function Oa(n,e,t){let i=re.empty();for(let s=0;s<n.length;++s){let r=n[s];if(e(r)){let o=r.path,a;if(r.snap)J(t,o)?(a=U(t,o),i=Dt(i,a,r.snap)):J(o,t)&&(a=U(o,t),i=Dt(i,T(),r.snap.getChild(a)));else if(r.children){if(J(t,o))a=U(t,o),i=Es(i,a,r.children);else if(J(o,t))if(a=U(o,t),v(a))i=Es(i,T(),r.children);else{let l=Te(r.children,y(a));if(l){let c=l.getChild(b(a));i=Dt(i,T(),c)}}}else throw Qe("WriteRecord should have .snap or .children")}}return i}function Ma(n,e,t,i,s){if(!i&&!s){let r=Ke(n.visibleWrites,e);if(r!=null)return r;{let o=Ae(n.visibleWrites,e);if(Ts(o))return t;if(t==null&&!Cs(o,T()))return null;{let a=t||m.EMPTY_NODE;return ut(o,a)}}}else{let r=Ae(n.visibleWrites,e);if(!s&&Ts(r))return t;if(!s&&t==null&&!Cs(r,T()))return null;{let o=function(c){return(c.visible||s)&&(!i||!~i.indexOf(c.writeId))&&(J(c.path,e)||J(e,c.path))},a=Oa(n.allWrites,o,e),l=t||m.EMPTY_NODE;return ut(a,l)}}}function Zu(n,e,t){let i=m.EMPTY_NODE,s=Ke(n.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(A,(r,o)=>{i=i.updateImmediateChild(r,o)}),i;if(t){let r=Ae(n.visibleWrites,e);return t.forEachChild(A,(o,a)=>{let l=ut(Ae(r,new I(o)),a);i=i.updateImmediateChild(o,l)}),Ko(r).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}else{let r=Ae(n.visibleWrites,e);return Ko(r).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}}function Ju(n,e,t,i,s){f(i||s,"Either existingEventSnap or existingServerSnap must exist");let r=R(e,t);if(Cs(n.visibleWrites,r))return null;{let o=Ae(n.visibleWrites,r);return Ts(o)?s.getChild(t):ut(o,s.getChild(t))}}function eh(n,e,t,i){let s=R(e,t),r=Ke(n.visibleWrites,s);if(r!=null)return r;if(i.isCompleteForChild(t)){let o=Ae(n.visibleWrites,s);return ut(o,i.getNode().getImmediateChild(t))}else return null}function th(n,e){return Ke(n.visibleWrites,e)}function nh(n,e,t,i,s,r,o){let a,l=Ae(n.visibleWrites,e),c=Ke(l,T());if(c!=null)a=c;else if(t!=null)a=ut(l,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){let u=[],h=o.getCompare(),d=r?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o),p=d.getNext();for(;p&&u.length<s;)h(p,i)!==0&&u.push(p),p=d.getNext();return u}else return[]}function ih(){return{visibleWrites:re.empty(),allWrites:[],lastWriteId:-1}}function Mn(n,e,t,i){return Ma(n.writeTree,n.treePath,e,t,i)}function ar(n,e){return Zu(n.writeTree,n.treePath,e)}function $o(n,e,t,i){return Ju(n.writeTree,n.treePath,e,t,i)}function Fn(n,e){return th(n.writeTree,R(n.treePath,e))}function sh(n,e,t,i,s,r){return nh(n.writeTree,n.treePath,e,t,i,s,r)}function lr(n,e,t){return eh(n.writeTree,n.treePath,e,t)}function Fa(n,e){return La(R(n.treePath,e),n.writeTree)}function La(n,e){return{treePath:n,writeTree:e}}var Is=class{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,i=e.childName;f(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),f(i!==".priority","Only non-priority child changes can be tracked.");let s=this.changeMap.get(i);if(s){let r=s.type;if(t==="child_added"&&r==="child_removed")this.changeMap.set(i,Ut(i,e.snapshotNode,s.snapshotNode));else if(t==="child_removed"&&r==="child_added")this.changeMap.delete(i);else if(t==="child_removed"&&r==="child_changed")this.changeMap.set(i,Wt(i,s.oldSnap));else if(t==="child_changed"&&r==="child_added")this.changeMap.set(i,lt(i,e.snapshotNode));else if(t==="child_changed"&&r==="child_changed")this.changeMap.set(i,Ut(i,e.snapshotNode,s.oldSnap));else throw Qe("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(i,e)}getChanges(){return Array.from(this.changeMap.values())}};var Ss=class{getCompleteChild(e){return null}getChildAfterChild(e,t,i){return null}},Wa=new Ss,Ht=class{constructor(e,t,i=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=i}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let i=this.optCompleteServerCache_!=null?new fe(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return lr(this.writes_,e,i)}}getChildAfterChild(e,t,i){let s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:He(this.viewCache_),r=sh(this.writes_,s,t,1,i,e);return r.length===0?null:r[0]}};function rh(n){return{filter:n}}function oh(n,e){f(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),f(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function ah(n,e,t,i,s){let r=new Is,o,a;if(t.type===ue.OVERWRITE){let c=t;c.source.fromUser?o=bs(n,e,c.path,c.snap,i,s,r):(f(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered()&&!v(c.path),o=Ln(n,e,c.path,c.snap,i,s,a,r))}else if(t.type===ue.MERGE){let c=t;c.source.fromUser?o=ch(n,e,c.path,c.children,i,s,r):(f(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered(),o=As(n,e,c.path,c.children,i,s,a,r))}else if(t.type===ue.ACK_USER_WRITE){let c=t;c.revert?o=dh(n,e,c.path,i,s,r):o=uh(n,e,c.path,c.affectedTree,i,s,r)}else if(t.type===ue.LISTEN_COMPLETE)o=hh(n,e,t.path,i,r);else throw Qe("Unknown operation type: "+t.type);let l=r.getChanges();return lh(e,o,l),{viewCache:o,changes:l}}function lh(n,e,t){let i=e.eventCache;if(i.isFullyInitialized()){let s=i.getNode().isLeafNode()||i.getNode().isEmpty(),r=On(n);(t.length>0||!n.eventCache.isFullyInitialized()||s&&!i.getNode().equals(r)||!i.getNode().getPriority().equals(r.getPriority()))&&t.push(Pa(On(e)))}}function Ua(n,e,t,i,s,r){let o=e.eventCache;if(Fn(i,t)!=null)return e;{let a,l;if(v(t))if(f(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){let c=He(e),u=c instanceof m?c:m.EMPTY_NODE,h=ar(i,u);a=n.filter.updateFullNode(e.eventCache.getNode(),h,r)}else{let c=Mn(i,He(e));a=n.filter.updateFullNode(e.eventCache.getNode(),c,r)}else{let c=y(t);if(c===".priority"){f(Ne(t)===1,"Can't have a priority with additional path components");let u=o.getNode();l=e.serverCache.getNode();let h=$o(i,t,u,l);h!=null?a=n.filter.updatePriority(u,h):a=o.getNode()}else{let u=b(t),h;if(o.isCompleteForChild(c)){l=e.serverCache.getNode();let d=$o(i,t,o.getNode(),l);d!=null?h=o.getNode().getImmediateChild(c).updateChild(u,d):h=o.getNode().getImmediateChild(c)}else h=lr(i,c,e.serverCache);h!=null?a=n.filter.updateChild(o.getNode(),c,h,u,s,r):a=o.getNode()}}return xt(e,a,o.isFullyInitialized()||v(t),n.filter.filtersNodes())}}function Ln(n,e,t,i,s,r,o,a){let l=e.serverCache,c,u=o?n.filter:n.filter.getIndexedFilter();if(v(t))c=u.updateFullNode(l.getNode(),i,null);else if(u.filtersNodes()&&!l.isFiltered()){let p=l.getNode().updateChild(t,i);c=u.updateFullNode(l.getNode(),p,null)}else{let p=y(t);if(!l.isCompleteForPath(t)&&Ne(t)>1)return e;let _=b(t),S=l.getNode().getImmediateChild(p).updateChild(_,i);p===".priority"?c=u.updatePriority(l.getNode(),S):c=u.updateChild(l.getNode(),p,S,_,Wa,null)}let h=xa(e,c,l.isFullyInitialized()||v(t),u.filtersNodes()),d=new Ht(s,h,r);return Ua(n,h,t,s,d,a)}function bs(n,e,t,i,s,r,o){let a=e.eventCache,l,c,u=new Ht(s,e,r);if(v(t))c=n.filter.updateFullNode(e.eventCache.getNode(),i,o),l=xt(e,c,!0,n.filter.filtersNodes());else{let h=y(t);if(h===".priority")c=n.filter.updatePriority(e.eventCache.getNode(),i),l=xt(e,c,a.isFullyInitialized(),a.isFiltered());else{let d=b(t),p=a.getNode().getImmediateChild(h),_;if(v(d))_=i;else{let E=u.getCompleteChild(h);E!=null?Js(d)===".priority"&&E.getChild(Sa(d)).isEmpty()?_=E:_=E.updateChild(d,i):_=m.EMPTY_NODE}if(p.equals(_))l=e;else{let E=n.filter.updateChild(a.getNode(),h,_,d,u,o);l=xt(e,E,a.isFullyInitialized(),n.filter.filtersNodes())}}}return l}function zo(n,e){return n.eventCache.isCompleteForChild(e)}function ch(n,e,t,i,s,r,o){let a=e;return i.foreach((l,c)=>{let u=R(t,l);zo(e,y(u))&&(a=bs(n,a,u,c,s,r,o))}),i.foreach((l,c)=>{let u=R(t,l);zo(e,y(u))||(a=bs(n,a,u,c,s,r,o))}),a}function qo(n,e,t){return t.foreach((i,s)=>{e=e.updateChild(i,s)}),e}function As(n,e,t,i,s,r,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,c;v(t)?c=i:c=new B(null).setTree(t,i);let u=e.serverCache.getNode();return c.children.inorderTraversal((h,d)=>{if(u.hasChild(h)){let p=e.serverCache.getNode().getImmediateChild(h),_=qo(n,p,d);l=Ln(n,l,new I(h),_,s,r,o,a)}}),c.children.inorderTraversal((h,d)=>{let p=!e.serverCache.isCompleteForChild(h)&&d.value===null;if(!u.hasChild(h)&&!p){let _=e.serverCache.getNode().getImmediateChild(h),E=qo(n,_,d);l=Ln(n,l,new I(h),E,s,r,o,a)}}),l}function uh(n,e,t,i,s,r,o){if(Fn(s,t)!=null)return e;let a=e.serverCache.isFiltered(),l=e.serverCache;if(i.value!=null){if(v(t)&&l.isFullyInitialized()||l.isCompleteForPath(t))return Ln(n,e,t,l.getNode().getChild(t),s,r,a,o);if(v(t)){let c=new B(null);return l.getNode().forEachChild(he,(u,h)=>{c=c.set(new I(u),h)}),As(n,e,t,c,s,r,a,o)}else return e}else{let c=new B(null);return i.foreach((u,h)=>{let d=R(t,u);l.isCompleteForPath(d)&&(c=c.set(u,l.getNode().getChild(d)))}),As(n,e,t,c,s,r,a,o)}}function hh(n,e,t,i,s){let r=e.serverCache,o=xa(e,r.getNode(),r.isFullyInitialized()||v(t),r.isFiltered());return Ua(n,o,t,i,Wa,s)}function dh(n,e,t,i,s,r){let o;if(Fn(i,t)!=null)return e;{let a=new Ht(i,e,s),l=e.eventCache.getNode(),c;if(v(t)||y(t)===".priority"){let u;if(e.serverCache.isFullyInitialized())u=Mn(i,He(e));else{let h=e.serverCache.getNode();f(h instanceof m,"serverChildren would be complete if leaf node"),u=ar(i,h)}u=u,c=n.filter.updateFullNode(l,u,r)}else{let u=y(t),h=lr(i,u,e.serverCache);h==null&&e.serverCache.isCompleteForChild(u)&&(h=l.getImmediateChild(u)),h!=null?c=n.filter.updateChild(l,u,h,b(t),a,r):e.eventCache.getNode().hasChild(u)?c=n.filter.updateChild(l,u,m.EMPTY_NODE,b(t),a,r):c=l,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Mn(i,He(e)),o.isLeafNode()&&(c=n.filter.updateFullNode(c,o,r)))}return o=e.serverCache.isFullyInitialized()||Fn(i,T())!=null,xt(e,c,o,n.filter.filtersNodes())}}var ks=class{constructor(e,t){this.query_=e,this.eventRegistrations_=[];let i=this.query_._queryParams,s=new Bt(i.getIndex()),r=Du(i);this.processor_=rh(r);let o=t.serverCache,a=t.eventCache,l=s.updateFullNode(m.EMPTY_NODE,o.getNode(),null),c=r.updateFullNode(m.EMPTY_NODE,a.getNode(),null),u=new fe(l,o.isFullyInitialized(),s.filtersNodes()),h=new fe(c,a.isFullyInitialized(),r.filtersNodes());this.viewCache_=Xn(h,u),this.eventGenerator_=new ws(this.query_)}get query(){return this.query_}};function fh(n){return n.viewCache_.serverCache.getNode()}function ph(n){return On(n.viewCache_)}function _h(n,e){let t=He(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!v(e)&&!t.getImmediateChild(y(e)).isEmpty())?t.getChild(e):null}function Qo(n){return n.eventRegistrations_.length===0}function gh(n,e){n.eventRegistrations_.push(e)}function Yo(n,e,t){let i=[];if(t){f(e==null,"A cancel should cancel all event registrations.");let s=n.query._path;n.eventRegistrations_.forEach(r=>{let o=r.createCancelEvent(t,s);o&&i.push(o)})}if(e){let s=[];for(let r=0;r<n.eventRegistrations_.length;++r){let o=n.eventRegistrations_[r];if(!o.matches(e))s.push(o);else if(e.hasAnyCallback()){s=s.concat(n.eventRegistrations_.slice(r+1));break}}n.eventRegistrations_=s}else n.eventRegistrations_=[];return i}function Xo(n,e,t,i){e.type===ue.MERGE&&e.source.queryId!==null&&(f(He(n.viewCache_),"We should always have a full cache before handling merges"),f(On(n.viewCache_),"Missing event cache, even though we have a server cache"));let s=n.viewCache_,r=ah(n.processor_,s,e,t,i);return oh(n.processor_,r.viewCache),f(r.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=r.viewCache,Ba(n,r.changes,r.viewCache.eventCache.getNode(),null)}function mh(n,e){let t=n.viewCache_.eventCache,i=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(A,(r,o)=>{i.push(lt(r,o))}),t.isFullyInitialized()&&i.push(Pa(t.getNode())),Ba(n,i,t.getNode(),e)}function Ba(n,e,t,i){let s=i?[i]:n.eventRegistrations_;return Vu(n.eventGenerator_,e,t,s)}var Wn,Un=class{constructor(){this.views=new Map}};function yh(n){f(!Wn,"__referenceConstructor has already been defined"),Wn=n}function vh(){return f(Wn,"Reference.ts has not been loaded"),Wn}function wh(n){return n.views.size===0}function cr(n,e,t,i){let s=e.source.queryId;if(s!==null){let r=n.views.get(s);return f(r!=null,"SyncTree gave us an op for an invalid query."),Xo(r,e,t,i)}else{let r=[];for(let o of n.views.values())r=r.concat(Xo(o,e,t,i));return r}}function Va(n,e,t,i,s){let r=e._queryIdentifier,o=n.views.get(r);if(!o){let a=Mn(t,s?i:null),l=!1;a?l=!0:i instanceof m?(a=ar(t,i),l=!1):(a=m.EMPTY_NODE,l=!1);let c=Xn(new fe(a,l,!1),new fe(i,s,!1));return new ks(e,c)}return o}function Eh(n,e,t,i,s,r){let o=Va(n,e,i,s,r);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),gh(o,t),mh(o,t)}function Ch(n,e,t,i){let s=e._queryIdentifier,r=[],o=[],a=Pe(n);if(s==="default")for(let[l,c]of n.views.entries())o=o.concat(Yo(c,t,i)),Qo(c)&&(n.views.delete(l),c.query._queryParams.loadsAllData()||r.push(c.query));else{let l=n.views.get(s);l&&(o=o.concat(Yo(l,t,i)),Qo(l)&&(n.views.delete(s),l.query._queryParams.loadsAllData()||r.push(l.query)))}return a&&!Pe(n)&&r.push(new(vh())(e._repo,e._path)),{removed:r,events:o}}function ja(n){let e=[];for(let t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function ke(n,e){let t=null;for(let i of n.views.values())t=t||_h(i,e);return t}function Ha(n,e){if(e._queryParams.loadsAllData())return Jn(n);{let i=e._queryIdentifier;return n.views.get(i)}}function Ga(n,e){return Ha(n,e)!=null}function Pe(n){return Jn(n)!=null}function Jn(n){for(let e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}var Bn;function Th(n){f(!Bn,"__referenceConstructor has already been defined"),Bn=n}function Ih(){return f(Bn,"Reference.ts has not been loaded"),Bn}var Sh=1,Vn=class{constructor(e){this.listenProvider_=e,this.syncPointTree_=new B(null),this.pendingWriteTree_=ih(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function ur(n,e,t,i,s){return Ku(n.pendingWriteTree_,e,t,i,s),s?_t(n,new ct(sr(),e,t)):[]}function bh(n,e,t,i){$u(n.pendingWriteTree_,e,t,i);let s=B.fromObject(t);return _t(n,new jt(sr(),e,s))}function be(n,e,t=!1){let i=zu(n.pendingWriteTree_,e);if(qu(n.pendingWriteTree_,e)){let r=new B(null);return i.snap!=null?r=r.set(T(),!0):M(i.children,o=>{r=r.set(new I(o),!0)}),_t(n,new vs(i.path,r,t))}else return[]}function Zt(n,e,t){return _t(n,new ct(rr(),e,t))}function Ah(n,e,t){let i=B.fromObject(t);return _t(n,new jt(rr(),e,i))}function kh(n,e){return _t(n,new Dn(rr(),e))}function Rh(n,e,t){let i=hr(n,t);if(i){let s=dr(i),r=s.path,o=s.queryId,a=U(r,e),l=new Dn(or(o),a);return fr(n,r,l)}else return[]}function jn(n,e,t,i,s=!1){let r=e._path,o=n.syncPointTree_.get(r),a=[];if(o&&(e._queryIdentifier==="default"||Ga(o,e))){let l=Ch(o,e,t,i);wh(o)&&(n.syncPointTree_=n.syncPointTree_.remove(r));let c=l.removed;if(a=l.events,!s){let u=c.findIndex(d=>d._queryParams.loadsAllData())!==-1,h=n.syncPointTree_.findOnPath(r,(d,p)=>Pe(p));if(u&&!h){let d=n.syncPointTree_.subtree(r);if(!d.isEmpty()){let p=xh(d);for(let _=0;_<p.length;++_){let E=p[_],S=E.query,H=qa(n,E);n.listenProvider_.startListening(Ot(S),Gt(n,S),H.hashFn,H.onComplete)}}}!h&&c.length>0&&!i&&(u?n.listenProvider_.stopListening(Ot(e),null):c.forEach(d=>{let p=n.queryToTagMap.get(ti(d));n.listenProvider_.stopListening(Ot(d),p)}))}Dh(n,c)}return a}function Ka(n,e,t,i){let s=hr(n,i);if(s!=null){let r=dr(s),o=r.path,a=r.queryId,l=U(o,e),c=new ct(or(a),l,t);return fr(n,o,c)}else return[]}function Nh(n,e,t,i){let s=hr(n,i);if(s){let r=dr(s),o=r.path,a=r.queryId,l=U(o,e),c=B.fromObject(t),u=new jt(or(a),l,c);return fr(n,o,u)}else return[]}function Rs(n,e,t,i=!1){let s=e._path,r=null,o=!1;n.syncPointTree_.foreachOnPath(s,(d,p)=>{let _=U(d,s);r=r||ke(p,_),o=o||Pe(p)});let a=n.syncPointTree_.get(s);a?(o=o||Pe(a),r=r||ke(a,T())):(a=new Un,n.syncPointTree_=n.syncPointTree_.set(s,a));let l;r!=null?l=!0:(l=!1,r=m.EMPTY_NODE,n.syncPointTree_.subtree(s).foreachChild((p,_)=>{let E=ke(_,T());E&&(r=r.updateImmediateChild(p,E))}));let c=Ga(a,e);if(!c&&!e._queryParams.loadsAllData()){let d=ti(e);f(!n.queryToTagMap.has(d),"View does not exist, but we have a tag");let p=Oh();n.queryToTagMap.set(d,p),n.tagToQueryMap.set(p,d)}let u=Zn(n.pendingWriteTree_,s),h=Eh(a,e,t,u,r,l);if(!c&&!o&&!i){let d=Ha(a,e);h=h.concat(Mh(n,e,d))}return h}function ei(n,e,t){let s=n.pendingWriteTree_,r=n.syncPointTree_.findOnPath(e,(o,a)=>{let l=U(o,e),c=ke(a,l);if(c)return c});return Ma(s,e,r,t,!0)}function Ph(n,e){let t=e._path,i=null;n.syncPointTree_.foreachOnPath(t,(c,u)=>{let h=U(c,t);i=i||ke(u,h)});let s=n.syncPointTree_.get(t);s?i=i||ke(s,T()):(s=new Un,n.syncPointTree_=n.syncPointTree_.set(t,s));let r=i!=null,o=r?new fe(i,!0,!1):null,a=Zn(n.pendingWriteTree_,e._path),l=Va(s,e,a,r?o.getNode():m.EMPTY_NODE,r);return ph(l)}function _t(n,e){return $a(e,n.syncPointTree_,null,Zn(n.pendingWriteTree_,T()))}function $a(n,e,t,i){if(v(n.path))return za(n,e,t,i);{let s=e.get(T());t==null&&s!=null&&(t=ke(s,T()));let r=[],o=y(n.path),a=n.operationForChild(o),l=e.children.get(o);if(l&&a){let c=t?t.getImmediateChild(o):null,u=Fa(i,o);r=r.concat($a(a,l,c,u))}return s&&(r=r.concat(cr(s,n,i,t))),r}}function za(n,e,t,i){let s=e.get(T());t==null&&s!=null&&(t=ke(s,T()));let r=[];return e.children.inorderTraversal((o,a)=>{let l=t?t.getImmediateChild(o):null,c=Fa(i,o),u=n.operationForChild(o);u&&(r=r.concat(za(u,a,l,c)))}),s&&(r=r.concat(cr(s,n,i,t))),r}function qa(n,e){let t=e.query,i=Gt(n,t);return{hashFn:()=>(fh(e)||m.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return i?Rh(n,t._path,i):kh(n,t._path);{let r=Kc(s,t);return jn(n,t,null,r)}}}}function Gt(n,e){let t=ti(e);return n.queryToTagMap.get(t)}function ti(n){return n._path.toString()+"$"+n._queryIdentifier}function hr(n,e){return n.tagToQueryMap.get(e)}function dr(n){let e=n.indexOf("$");return f(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new I(n.substr(0,e))}}function fr(n,e,t){let i=n.syncPointTree_.get(e);f(i,"Missing sync point for query tag that we're tracking");let s=Zn(n.pendingWriteTree_,e);return cr(i,t,s,null)}function xh(n){return n.fold((e,t,i)=>{if(t&&Pe(t))return[Jn(t)];{let s=[];return t&&(s=ja(t)),M(i,(r,o)=>{s=s.concat(o)}),s}})}function Ot(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(Ih())(n._repo,n._path):n}function Dh(n,e){for(let t=0;t<e.length;++t){let i=e[t];if(!i._queryParams.loadsAllData()){let s=ti(i),r=n.queryToTagMap.get(s);n.queryToTagMap.delete(s),n.tagToQueryMap.delete(r)}}}function Oh(){return Sh++}function Mh(n,e,t){let i=e._path,s=Gt(n,e),r=qa(n,t),o=n.listenProvider_.startListening(Ot(e),s,r.hashFn,r.onComplete),a=n.syncPointTree_.subtree(i);if(s)f(!Pe(a.value),"If we're adding a query, it shouldn't be shadowed");else{let l=a.fold((c,u,h)=>{if(!v(c)&&u&&Pe(u))return[Jn(u).query];{let d=[];return u&&(d=d.concat(ja(u).map(p=>p.query))),M(h,(p,_)=>{d=d.concat(_)}),d}});for(let c=0;c<l.length;++c){let u=l[c];n.listenProvider_.stopListening(Ot(u),Gt(n,u))}}return o}var Ns=class n{constructor(e){this.node_=e}getImmediateChild(e){let t=this.node_.getImmediateChild(e);return new n(t)}node(){return this.node_}},Ps=class n{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=R(this.path_,e);return new n(this.syncTree_,t)}node(){return ei(this.syncTree_,this.path_)}},Fh=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},Zo=function(n,e,t){if(!n||typeof n!="object")return n;if(f(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return Lh(n[".sv"],e,t);if(typeof n[".sv"]=="object")return Wh(n[".sv"],e);f(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},Lh=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:f(!1,"Unexpected server value: "+n)}},Wh=function(n,e,t){n.hasOwnProperty("increment")||f(!1,"Unexpected server value: "+JSON.stringify(n,null,2));let i=n.increment;typeof i!="number"&&f(!1,"Unexpected increment value: "+i);let s=e.node();if(f(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return i;let o=s.getValue();return typeof o!="number"?i:o+i},Qa=function(n,e,t,i){return _r(e,new Ps(t,n),i)},pr=function(n,e,t){return _r(n,new Ns(e),t)};function _r(n,e,t){let i=n.getPriority().val(),s=Zo(i,e.getImmediateChild(".priority"),t),r;if(n.isLeafNode()){let o=n,a=Zo(o.getValue(),e,t);return a!==o.getValue()||s!==o.getPriority().val()?new ot(a,N(s)):n}else{let o=n;return r=o,s!==o.getPriority().val()&&(r=r.updatePriority(new ot(s))),o.forEachChild(A,(a,l)=>{let c=_r(l,e.getImmediateChild(a),t);c!==l&&(r=r.updateImmediateChild(a,c))}),r}}var Kt=class{constructor(e="",t=null,i={children:{},childCount:0}){this.name=e,this.parent=t,this.node=i}};function ni(n,e){let t=e instanceof I?e:new I(e),i=n,s=y(t);for(;s!==null;){let r=Te(i.node.children,s)||{children:{},childCount:0};i=new Kt(s,i,r),t=b(t),s=y(t)}return i}function $e(n){return n.node.value}function gr(n,e){n.node.value=e,xs(n)}function Ya(n){return n.node.childCount>0}function Uh(n){return $e(n)===void 0&&!Ya(n)}function ii(n,e){M(n.node.children,(t,i)=>{e(new Kt(t,n,i))})}function Xa(n,e,t,i){t&&!i&&e(n),ii(n,s=>{Xa(s,e,!0,i)}),t&&i&&e(n)}function Bh(n,e,t){let i=t?n:n.parent;for(;i!==null;){if(e(i))return!0;i=i.parent}return!1}function Jt(n){return new I(n.parent===null?n.name:Jt(n.parent)+"/"+n.name)}function xs(n){n.parent!==null&&Vh(n.parent,n.name,n)}function Vh(n,e,t){let i=Uh(t),s=X(n.node.children,e);i&&s?(delete n.node.children[e],n.node.childCount--,xs(n)):!i&&!s&&(n.node.children[e]=t.node,n.node.childCount++,xs(n))}var jh=/[\[\].#$\/\u0000-\u001F\u007F]/,Hh=/[\[\].#$\u0000-\u001F\u007F]/,Hi=10*1024*1024,si=function(n){return typeof n=="string"&&n.length!==0&&!jh.test(n)},Za=function(n){return typeof n=="string"&&n.length!==0&&!Hh.test(n)},Gh=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Za(n)},$t=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!Qn(n)||n&&typeof n=="object"&&X(n,".sv")},pe=function(n,e,t,i){i&&e===void 0||en(j(n,"value"),e,t)},en=function(n,e,t){let i=t instanceof I?new ns(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+Be(i));if(typeof e=="function")throw new Error(n+"contains a function "+Be(i)+" with contents = "+e.toString());if(Qn(e))throw new Error(n+"contains "+e.toString()+" "+Be(i));if(typeof e=="string"&&e.length>Hi/3&&Et(e)>Hi)throw new Error(n+"contains a string greater than "+Hi+" utf8 bytes "+Be(i)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,r=!1;if(M(e,(o,a)=>{if(o===".value")s=!0;else if(o!==".priority"&&o!==".sv"&&(r=!0,!si(o)))throw new Error(n+" contains an invalid key ("+o+") "+Be(i)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);wu(i,o),en(n,a,i),Eu(i)}),s&&r)throw new Error(n+' contains ".value" child '+Be(i)+" in addition to actual children.")}},Kh=function(n,e){let t,i;for(t=0;t<e.length;t++){i=e[t];let r=Ft(i);for(let o=0;o<r.length;o++)if(!(r[o]===".priority"&&o===r.length-1)){if(!si(r[o]))throw new Error(n+"contains an invalid key ("+r[o]+") in path "+i.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(vu);let s=null;for(t=0;t<e.length;t++){if(i=e[t],s!==null&&J(s,i))throw new Error(n+"contains a path "+s.toString()+" that is ancestor of another path "+i.toString());s=i}},Ja=function(n,e,t,i){if(i&&e===void 0)return;let s=j(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(s+" must be an object containing the children to replace.");let r=[];M(e,(o,a)=>{let l=new I(o);if(en(s,a,R(t,l)),Js(l)===".priority"&&!$t(a))throw new Error(s+"contains an invalid value for '"+l.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");r.push(l)}),Kh(s,r)},mr=function(n,e,t){if(!(t&&e===void 0)){if(Qn(e))throw new Error(j(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!$t(e))throw new Error(j(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},tn=function(n,e,t,i){if(!(i&&t===void 0)&&!si(t))throw new Error(j(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},gt=function(n,e,t,i){if(!(i&&t===void 0)&&!Za(t))throw new Error(j(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},$h=function(n,e,t,i){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),gt(n,e,t,i)},z=function(n,e){if(y(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},el=function(n,e){let t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!si(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!Gh(t))throw new Error(j(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var Ds=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function ri(n,e){let t=null;for(let i=0;i<e.length;i++){let s=e[i],r=s.getPath();t!==null&&!er(r,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:r}),t.events.push(s)}t&&n.eventLists_.push(t)}function tl(n,e,t){ri(n,t),nl(n,i=>er(i,e))}function q(n,e,t){ri(n,t),nl(n,i=>J(i,e)||J(e,i))}function nl(n,e){n.recursionDepth_++;let t=!0;for(let i=0;i<n.eventLists_.length;i++){let s=n.eventLists_[i];if(s){let r=s.path;e(r)?(zh(n.eventLists_[i]),n.eventLists_[i]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function zh(n){for(let e=0;e<n.events.length;e++){let t=n.events[e];if(t!==null){n.events[e]=null;let i=t.getEventRunner();je&&O("event: "+t.toString()),ft(i)}}}var il="repo_interrupt",qh=25,Os=class{constructor(e,t,i,s){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=i,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Ds,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=xn(),this.transactionQueueTree_=new Kt,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function Qh(n,e,t){if(n.stats_=Zs(n.repoInfo_),n.forceRestClient_||Qc())n.server_=new fs(n.repoInfo_,(i,s,r,o)=>{Jo(n,i,s,r,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>ea(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{P(t)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}n.persistentConnection_=new tr(n.repoInfo_,e,(i,s,r,o)=>{Jo(n,i,s,r,o)},i=>{ea(n,i)},i=>{Yh(n,i)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(i=>{n.server_.refreshAuthToken(i)}),n.appCheckProvider_.addTokenChangeListener(i=>{n.server_.refreshAppCheckToken(i.token)}),n.statsReporter_=Xc(n.repoInfo_,()=>new ys(n.stats_,n.server_)),n.infoData_=new ps,n.infoSyncTree_=new Vn({startListening:(i,s,r,o)=>{let a=[],l=n.infoData_.getNode(i._path);return l.isEmpty()||(a=Zt(n.infoSyncTree_,i._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),yr(n,"connected",!1),n.serverSyncTree_=new Vn({startListening:(i,s,r,o)=>(n.server_.listen(i,r,s,(a,l)=>{let c=o(a,l);q(n.eventQueue_,i._path,c)}),[]),stopListening:(i,s)=>{n.server_.unlisten(i,s)}})}function sl(n){let t=n.infoData_.getNode(new I(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function nn(n){return Fh({timestamp:sl(n)})}function Jo(n,e,t,i,s){n.dataUpdateCount++;let r=new I(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(s)if(i){let l=wt(t,c=>N(c));o=Nh(n.serverSyncTree_,r,l,s)}else{let l=N(t);o=Ka(n.serverSyncTree_,r,l,s)}else if(i){let l=wt(t,c=>N(c));o=Ah(n.serverSyncTree_,r,l)}else{let l=N(t);o=Zt(n.serverSyncTree_,r,l)}let a=r;o.length>0&&(a=ht(n,r)),q(n.eventQueue_,a,o)}function ea(n,e){yr(n,"connected",e),e===!1&&Jh(n)}function Yh(n,e){M(e,(t,i)=>{yr(n,t,i)})}function yr(n,e,t){let i=new I("/.info/"+e),s=N(t);n.infoData_.updateSnapshot(i,s);let r=Zt(n.infoSyncTree_,i,s);q(n.eventQueue_,i,r)}function oi(n){return n.nextWriteId_++}function Xh(n,e,t){let i=Ph(n.serverSyncTree_,e);return i!=null?Promise.resolve(i):n.server_.get(e).then(s=>{let r=N(s).withIndex(e._queryParams.getIndex());Rs(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=Zt(n.serverSyncTree_,e._path,r);else{let a=Gt(n.serverSyncTree_,e);o=Ka(n.serverSyncTree_,e._path,r,a)}return q(n.eventQueue_,e._path,o),jn(n.serverSyncTree_,e,t,null,!0),r},s=>(mt(n,"get for query "+P(e)+" failed: "+s),Promise.reject(new Error(s))))}function vr(n,e,t,i,s){mt(n,"set",{path:e.toString(),value:t,priority:i});let r=nn(n),o=N(t,i),a=ei(n.serverSyncTree_,e),l=pr(o,a,r),c=oi(n),u=ur(n.serverSyncTree_,e,l,c,!0);ri(n.eventQueue_,u),n.server_.put(e.toString(),o.val(!0),(d,p)=>{let _=d==="ok";_||F("set at "+e+" failed: "+d);let E=be(n.serverSyncTree_,c,!_);q(n.eventQueue_,e,E),xe(n,s,d,p)});let h=Er(n,e);ht(n,h),q(n.eventQueue_,h,[])}function Zh(n,e,t,i){mt(n,"update",{path:e.toString(),value:t});let s=!0,r=nn(n),o={};if(M(t,(a,l)=>{s=!1,o[a]=Qa(R(e,a),N(l),n.serverSyncTree_,r)}),s)O("update() called with empty data.  Don't do anything."),xe(n,i,"ok",void 0);else{let a=oi(n),l=bh(n.serverSyncTree_,e,o,a);ri(n.eventQueue_,l),n.server_.merge(e.toString(),t,(c,u)=>{let h=c==="ok";h||F("update at "+e+" failed: "+c);let d=be(n.serverSyncTree_,a,!h),p=d.length>0?ht(n,e):e;q(n.eventQueue_,p,d),xe(n,i,c,u)}),M(t,c=>{let u=Er(n,R(e,c));ht(n,u)}),q(n.eventQueue_,e,[])}}function Jh(n){mt(n,"onDisconnectEvents");let e=nn(n),t=xn();gs(n.onDisconnect_,T(),(s,r)=>{let o=Qa(s,r,n.serverSyncTree_,e);pt(t,s,o)});let i=[];gs(t,T(),(s,r)=>{i=i.concat(Zt(n.serverSyncTree_,s,r));let o=Er(n,s);ht(n,o)}),n.onDisconnect_=xn(),q(n.eventQueue_,T(),i)}function ed(n,e,t){n.server_.onDisconnectCancel(e.toString(),(i,s)=>{i==="ok"&&_s(n.onDisconnect_,e),xe(n,t,i,s)})}function ta(n,e,t,i){let s=N(t);n.server_.onDisconnectPut(e.toString(),s.val(!0),(r,o)=>{r==="ok"&&pt(n.onDisconnect_,e,s),xe(n,i,r,o)})}function td(n,e,t,i,s){let r=N(t,i);n.server_.onDisconnectPut(e.toString(),r.val(!0),(o,a)=>{o==="ok"&&pt(n.onDisconnect_,e,r),xe(n,s,o,a)})}function nd(n,e,t,i){if(dn(t)){O("onDisconnect().update() called with empty data.  Don't do anything."),xe(n,i,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(s,r)=>{s==="ok"&&M(t,(o,a)=>{let l=N(a);pt(n.onDisconnect_,R(e,o),l)}),xe(n,i,s,r)})}function id(n,e,t){let i;y(e._path)===".info"?i=Rs(n.infoSyncTree_,e,t):i=Rs(n.serverSyncTree_,e,t),tl(n.eventQueue_,e._path,i)}function Ms(n,e,t){let i;y(e._path)===".info"?i=jn(n.infoSyncTree_,e,t):i=jn(n.serverSyncTree_,e,t),tl(n.eventQueue_,e._path,i)}function rl(n){n.persistentConnection_&&n.persistentConnection_.interrupt(il)}function sd(n){n.persistentConnection_&&n.persistentConnection_.resume(il)}function mt(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),O(t,...e)}function xe(n,e,t,i){e&&ft(()=>{if(t==="ok")e(null);else{let s=(t||"error").toUpperCase(),r=s;i&&(r+=": "+i);let o=new Error(r);o.code=s,e(o)}})}function rd(n,e,t,i,s,r){mt(n,"transaction on "+e);let o={path:e,update:t,onComplete:i,status:null,order:sa(),applyLocally:r,retryCount:0,unwatcher:s,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=wr(n,e,void 0);o.currentInputSnapshot=a;let l=o.update(a.val());if(l===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{en("transaction failed: Data returned ",l,o.path),o.status=0;let c=ni(n.transactionQueueTree_,e),u=$e(c)||[];u.push(o),gr(c,u);let h;typeof l=="object"&&l!==null&&X(l,".priority")?(h=Te(l,".priority"),f($t(h),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):h=(ei(n.serverSyncTree_,e)||m.EMPTY_NODE).getPriority().val();let d=nn(n),p=N(l,h),_=pr(p,a,d);o.currentOutputSnapshotRaw=p,o.currentOutputSnapshotResolved=_,o.currentWriteId=oi(n);let E=ur(n.serverSyncTree_,e,_,o.currentWriteId,o.applyLocally);q(n.eventQueue_,e,E),ai(n,n.transactionQueueTree_)}}function wr(n,e,t){return ei(n.serverSyncTree_,e,t)||m.EMPTY_NODE}function ai(n,e=n.transactionQueueTree_){if(e||li(n,e),$e(e)){let t=al(n,e);f(t.length>0,"Sending zero length transaction queue"),t.every(s=>s.status===0)&&od(n,Jt(e),t)}else Ya(e)&&ii(e,t=>{ai(n,t)})}function od(n,e,t){let i=t.map(c=>c.currentWriteId),s=wr(n,e,i),r=s,o=s.hash();for(let c=0;c<t.length;c++){let u=t[c];f(u.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=1,u.retryCount++;let h=U(e,u.path);r=r.updateChild(h,u.currentOutputSnapshotRaw)}let a=r.val(!0),l=e;n.server_.put(l.toString(),a,c=>{mt(n,"transaction put response",{path:l.toString(),status:c});let u=[];if(c==="ok"){let h=[];for(let d=0;d<t.length;d++)t[d].status=2,u=u.concat(be(n.serverSyncTree_,t[d].currentWriteId)),t[d].onComplete&&h.push(()=>t[d].onComplete(null,!0,t[d].currentOutputSnapshotResolved)),t[d].unwatcher();li(n,ni(n.transactionQueueTree_,e)),ai(n,n.transactionQueueTree_),q(n.eventQueue_,e,u);for(let d=0;d<h.length;d++)ft(h[d])}else{if(c==="datastale")for(let h=0;h<t.length;h++)t[h].status===3?t[h].status=4:t[h].status=0;else{F("transaction at "+l.toString()+" failed: "+c);for(let h=0;h<t.length;h++)t[h].status=4,t[h].abortReason=c}ht(n,e)}},o)}function ht(n,e){let t=ol(n,e),i=Jt(t),s=al(n,t);return ad(n,s,i),i}function ad(n,e,t){if(e.length===0)return;let i=[],s=[],o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){let l=e[a],c=U(t,l.path),u=!1,h;if(f(c!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)u=!0,h=l.abortReason,s=s.concat(be(n.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=qh)u=!0,h="maxretry",s=s.concat(be(n.serverSyncTree_,l.currentWriteId,!0));else{let d=wr(n,l.path,o);l.currentInputSnapshot=d;let p=e[a].update(d.val());if(p!==void 0){en("transaction failed: Data returned ",p,l.path);let _=N(p);typeof p=="object"&&p!=null&&X(p,".priority")||(_=_.updatePriority(d.getPriority()));let S=l.currentWriteId,H=nn(n),G=pr(_,d,H);l.currentOutputSnapshotRaw=_,l.currentOutputSnapshotResolved=G,l.currentWriteId=oi(n),o.splice(o.indexOf(S),1),s=s.concat(ur(n.serverSyncTree_,l.path,G,l.currentWriteId,l.applyLocally)),s=s.concat(be(n.serverSyncTree_,S,!0))}else u=!0,h="nodata",s=s.concat(be(n.serverSyncTree_,l.currentWriteId,!0))}q(n.eventQueue_,t,s),s=[],u&&(e[a].status=2,function(d){setTimeout(d,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(h==="nodata"?i.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):i.push(()=>e[a].onComplete(new Error(h),!1,null))))}li(n,n.transactionQueueTree_);for(let a=0;a<i.length;a++)ft(i[a]);ai(n,n.transactionQueueTree_)}function ol(n,e){let t,i=n.transactionQueueTree_;for(t=y(e);t!==null&&$e(i)===void 0;)i=ni(i,t),e=b(e),t=y(e);return i}function al(n,e){let t=[];return ll(n,e,t),t.sort((i,s)=>i.order-s.order),t}function ll(n,e,t){let i=$e(e);if(i)for(let s=0;s<i.length;s++)t.push(i[s]);ii(e,s=>{ll(n,s,t)})}function li(n,e){let t=$e(e);if(t){let i=0;for(let s=0;s<t.length;s++)t[s].status!==2&&(t[i]=t[s],i++);t.length=i,gr(e,t.length>0?t:void 0)}ii(e,i=>{li(n,i)})}function Er(n,e){let t=Jt(ol(n,e)),i=ni(n.transactionQueueTree_,e);return Bh(i,s=>{Gi(n,s)}),Gi(n,i),Xa(i,s=>{Gi(n,s)}),t}function Gi(n,e){let t=$e(e);if(t){let i=[],s=[],r=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(f(r===o-1,"All SENT items should be at beginning of queue."),r=o,t[o].status=3,t[o].abortReason="set"):(f(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),s=s.concat(be(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&i.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));r===-1?gr(e,void 0):t.length=r+1,q(n.eventQueue_,Jt(e),s);for(let o=0;o<i.length;o++)ft(i[o])}}function ld(n){let e="",t=n.split("/");for(let i=0;i<t.length;i++)if(t[i].length>0){let s=t[i];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function cd(n){let e={};n.charAt(0)==="?"&&(n=n.substring(1));for(let t of n.split("&")){if(t.length===0)continue;let i=t.split("=");i.length===2?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):F(`Invalid query segment '${t}' in query '${n}'`)}return e}var Fs=function(n,e){let t=ud(n),i=t.namespace;t.domain==="firebase.com"&&de(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||i==="undefined")&&t.domain!=="localhost"&&de("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||Bc();let s=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new In(t.host,t.secure,i,s,e,"",i!==t.subdomain),path:new I(t.pathString)}},ud=function(n){let e="",t="",i="",s="",r="",o=!0,a="https",l=443;if(typeof n=="string"){let c=n.indexOf("//");c>=0&&(a=n.substring(0,c-1),n=n.substring(c+2));let u=n.indexOf("/");u===-1&&(u=n.length);let h=n.indexOf("?");h===-1&&(h=n.length),e=n.substring(0,Math.min(u,h)),u<h&&(s=ld(n.substring(u,h)));let d=cd(n.substring(Math.min(n.length,h)));c=e.indexOf(":"),c>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(c+1),10)):c=e.length;let p=e.slice(0,c);if(p.toLowerCase()==="localhost")t="localhost";else if(p.split(".").length<=2)t=p;else{let _=e.indexOf(".");i=e.substring(0,_).toLowerCase(),t=e.substring(_+1),r=i}"ns"in d&&(r=d.ns)}return{host:e,port:l,domain:t,subdomain:i,secure:o,scheme:a,pathString:s,namespace:r}};var na="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",hd=function(){let n=0,e=[];return function(t){let i=t===n;n=t;let s,r=new Array(8);for(s=7;s>=0;s--)r[s]=na.charAt(t%64),t=Math.floor(t/64);f(t===0,"Cannot push at time == 0");let o=r.join("");if(i){for(s=11;s>=0&&e[s]===63;s--)e[s]=0;e[s]++}else for(s=0;s<12;s++)e[s]=Math.floor(Math.random()*64);for(s=0;s<12;s++)o+=na.charAt(e[s]);return f(o.length===20,"nextPushId: Length should be 20."),o}}();var Hn=class{constructor(e,t,i,s){this.eventType=e,this.eventRegistration=t,this.snapshot=i,this.prevName=s}getPath(){let e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+P(this.snapshot.exportVal())}},Gn=class{constructor(e,t,i){this.eventRegistration=e,this.error=t,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}};var zt=class{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return f(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}};var Kn=class{constructor(e,t){this._repo=e,this._path=t}cancel(){let e=new D;return ed(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){z("OnDisconnect.remove",this._path);let e=new D;return ta(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){z("OnDisconnect.set",this._path),pe("OnDisconnect.set",e,this._path,!1);let t=new D;return ta(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){z("OnDisconnect.setWithPriority",this._path),pe("OnDisconnect.setWithPriority",e,this._path,!1),mr("OnDisconnect.setWithPriority",t,!1);let i=new D;return td(this._repo,this._path,e,t,i.wrapCallback(()=>{})),i.promise}update(e){z("OnDisconnect.update",this._path),Ja("OnDisconnect.update",e,this._path,!1);let t=new D;return nd(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}};var V=class n{constructor(e,t,i,s){this._repo=e,this._path=t,this._queryParams=i,this._orderByCalled=s}get key(){return v(this._path)?null:Js(this._path)}get ref(){return new Q(this._repo,this._path)}get _queryIdentifier(){let e=jo(this._queryParams),t=Xs(e);return t==="{}"?"default":t}get _queryObject(){return jo(this._queryParams)}isEqual(e){if(e=W(e),!(e instanceof n))return!1;let t=this._repo===e._repo,i=er(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return t&&i&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+yu(this._path)}};function ci(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function Oe(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===he){let i="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",s="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==Re)throw new Error(i);if(typeof e!="string")throw new Error(s)}if(n.hasEnd()){if(n.getIndexEndName()!==me)throw new Error(i);if(typeof t!="string")throw new Error(s)}}else if(n.getIndex()===A){if(e!=null&&!$t(e)||t!=null&&!$t(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(f(n.getIndex()instanceof Lt||n.getIndex()===ir,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function ui(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}var Q=class n extends V{constructor(e,t){super(e,t,new Vt,!1)}get parent(){let e=Sa(this._path);return e===null?null:new n(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}},dt=class n{constructor(e,t,i){this._node=e,this.ref=t,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new I(e),i=De(this.ref,e);return new n(this._node.getChild(t),i,A)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(i,s)=>e(new n(s,De(this.ref,i),A)))}hasChild(e){let t=new I(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function Cr(n,e){return n=W(n),n._checkNotDeleted("ref"),e!==void 0?De(n._root,e):n._root}function Tr(n,e){n=W(n),n._checkNotDeleted("refFromURL");let t=Fs(e,n._repo.repoInfo_.nodeAdmin);el("refFromURL",t);let i=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&i.host!==n._repo.repoInfo_.host&&de("refFromURL: Host name does not match the current database: (found "+i.host+" but expected "+n._repo.repoInfo_.host+")"),Cr(n,t.path.toString())}function De(n,e){return n=W(n),y(n._path)===null?$h("child","path",e,!1):gt("child","path",e,!1),new Q(n._repo,R(n._path,e))}function cl(n,e){n=W(n),z("push",n._path),pe("push",e,n._path,!0);let t=sl(n._repo),i=hd(t),s=De(n,i),r=De(n,i),o;return e!=null?o=hi(r,e).then(()=>r):o=Promise.resolve(r),s.then=o.then.bind(o),s.catch=o.then.bind(o,void 0),s}function ul(n){return z("remove",n._path),hi(n,null)}function hi(n,e){n=W(n),z("set",n._path),pe("set",e,n._path,!1);let t=new D;return vr(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function hl(n,e){n=W(n),z("setPriority",n._path),mr("setPriority",e,!1);let t=new D;return vr(n._repo,R(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function dl(n,e,t){if(z("setWithPriority",n._path),pe("setWithPriority",e,n._path,!1),mr("setWithPriority",t,!1),n.key===".length"||n.key===".keys")throw"setWithPriority failed: "+n.key+" is a read-only object.";let i=new D;return vr(n._repo,n._path,e,t,i.wrapCallback(()=>{})),i.promise}function fl(n,e){Ja("update",e,n._path,!1);let t=new D;return Zh(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function pl(n){n=W(n);let e=new zt(()=>{}),t=new qt(e);return Xh(n._repo,n,t).then(i=>new dt(i,new Q(n._repo,n._path),n._queryParams.getIndex()))}var qt=class n{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){let i=t._queryParams.getIndex();return new Hn("value",this,new dt(e.snapshotNode,new Q(t._repo,t._path),i))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Gn(this,e,t):null}matches(e){return e instanceof n?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}},$n=class n{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Gn(this,e,t):null}createEvent(e,t){f(e.childName!=null,"Child events should have a childName.");let i=De(new Q(t._repo,t._path),e.childName),s=t._queryParams.getIndex();return new Hn(e.type,this,new dt(e.snapshotNode,i,s),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof n?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}};function sn(n,e,t,i,s){let r;if(typeof i=="object"&&(r=void 0,s=i),typeof i=="function"&&(r=i),s&&s.onlyOnce){let l=t,c=(u,h)=>{Ms(n._repo,n,a),l(u,h)};c.userCallback=t.userCallback,c.context=t.context,t=c}let o=new zt(t,r||void 0),a=e==="value"?new qt(o):new $n(e,o);return id(n._repo,n,a),()=>Ms(n._repo,n,a)}function di(n,e,t,i){return sn(n,"value",e,t,i)}function Ir(n,e,t,i){return sn(n,"child_added",e,t,i)}function Sr(n,e,t,i){return sn(n,"child_changed",e,t,i)}function br(n,e,t,i){return sn(n,"child_moved",e,t,i)}function Ar(n,e,t,i){return sn(n,"child_removed",e,t,i)}function kr(n,e,t){let i=null,s=t?new zt(t):null;e==="value"?i=new qt(s):e&&(i=new $n(e,s)),Ms(n._repo,n,i)}var Y=class{},zn=class extends Y{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){pe("endAt",this._value,e._path,!0);let t=ds(e._queryParams,this._value,this._key);if(ui(t),Oe(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new V(e._repo,e._path,t,e._orderByCalled)}};function _l(n,e){return tn("endAt","key",e,!0),new zn(n,e)}var Ls=class extends Y{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){pe("endBefore",this._value,e._path,!1);let t=Lu(e._queryParams,this._value,this._key);if(ui(t),Oe(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new V(e._repo,e._path,t,e._orderByCalled)}};function gl(n,e){return tn("endBefore","key",e,!0),new Ls(n,e)}var qn=class extends Y{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){pe("startAt",this._value,e._path,!0);let t=hs(e._queryParams,this._value,this._key);if(ui(t),Oe(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new V(e._repo,e._path,t,e._orderByCalled)}};function ml(n=null,e){return tn("startAt","key",e,!0),new qn(n,e)}var Ws=class extends Y{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){pe("startAfter",this._value,e._path,!1);let t=Fu(e._queryParams,this._value,this._key);if(ui(t),Oe(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new V(e._repo,e._path,t,e._orderByCalled)}};function yl(n,e){return tn("startAfter","key",e,!0),new Ws(n,e)}var Us=class extends Y{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new V(e._repo,e._path,Ou(e._queryParams,this._limit),e._orderByCalled)}};function vl(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new Us(n)}var Bs=class extends Y{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new V(e._repo,e._path,Mu(e._queryParams,this._limit),e._orderByCalled)}};function wl(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new Bs(n)}var Vs=class extends Y{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){ci(e,"orderByChild");let t=new I(this._path);if(v(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");let i=new Lt(t),s=Yn(e._queryParams,i);return Oe(s),new V(e._repo,e._path,s,!0)}};function El(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return gt("orderByChild","path",n,!1),new Vs(n)}var js=class extends Y{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){ci(e,"orderByKey");let t=Yn(e._queryParams,he);return Oe(t),new V(e._repo,e._path,t,!0)}};function Cl(){return new js}var Hs=class extends Y{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){ci(e,"orderByPriority");let t=Yn(e._queryParams,A);return Oe(t),new V(e._repo,e._path,t,!0)}};function Tl(){return new Hs}var Gs=class extends Y{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){ci(e,"orderByValue");let t=Yn(e._queryParams,ir);return Oe(t),new V(e._repo,e._path,t,!0)}};function Il(){return new Gs}var Ks=class extends Y{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(pe("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new zn(this._value,this._key)._apply(new qn(this._value,this._key)._apply(e))}};function Sl(n,e){return tn("equalTo","key",e,!0),new Ks(n,e)}function te(n,...e){let t=W(n);for(let i of e)t=i._apply(t);return t}yh(Q);Th(Q);var dd="FIREBASE_DATABASE_EMULATOR_HOST",$s={},fd=!1;function pd(n,e,t,i){n.repoInfo_=new In(`${e}:${t}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0),i&&(n.authTokenProvider_=i)}function Rr(n,e,t,i,s){let r=i||n.options.databaseURL;r===void 0&&(n.options.projectId||de("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),O("Using default host for project ",n.options.projectId),r=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=Fs(r,s),a=o.repoInfo,l,c;typeof process<"u"&&process.env&&(c=process.env[dd]),c?(l=!0,r=`http://${c}?ns=${a.namespace}`,o=Fs(r,s),a=o.repoInfo):l=!o.repoInfo.secure;let u=s&&l?new Pt(Pt.OWNER):new Yi(n.name,n.options,e);el("Invalid Firebase Database URL",o),v(o.path)||de("Database URL must point to the root of a Firebase Database (not including a child path).");let h=gd(a,n,u,new Qi(n.name,t));return new zs(h,n)}function _d(n,e){let t=$s[e];(!t||t[n.key]!==n)&&de(`Database ${e}(${n.repoInfo_}) has already been deleted.`),rl(n),delete t[n.key]}function gd(n,e,t,i){let s=$s[e.name];s||(s={},$s[e.name]=s);let r=s[n.toURLString()];return r&&de("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new Os(n,fd,t,i),s[n.toURLString()]=r,r}var zs=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Qh(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Q(this._repo,T())),this._rootInternal}_delete(){return this._rootInternal!==null&&(_d(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&de("Cannot call "+e+" on a deleted database.")}};function bl(){Ia.IS_TRANSPORT_INITIALIZED&&F("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function Al(){bl(),Mt.forceDisallow()}function kl(){bl(),nt.forceDisallow(),Mt.forceAllow()}function Rl(n,e,t,i={}){n=W(n),n._checkNotDeleted("useEmulator"),n._instanceStarted&&de("Cannot call useEmulator() after instance has already been initialized.");let s=n._repoInternal,r;if(s.repoInfo_.nodeAdmin)i.mockUserToken&&de('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),r=new Pt(Pt.OWNER);else if(i.mockUserToken){let o=typeof i.mockUserToken=="string"?i.mockUserToken:Qr(i.mockUserToken,n.app.options.projectId);r=new Pt(o)}pd(s,e,t,r)}function Nl(n){n=W(n),n._checkNotDeleted("goOffline"),rl(n._repo)}function Pl(n){n=W(n),n._checkNotDeleted("goOnline"),sd(n._repo)}function xl(n,e){oa(n,e)}function md(n){Ys(ro),Ct(new ge("database",(e,{instanceIdentifier:t})=>{let i=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return Rr(i,s,r,t)},"PUBLIC").setMultipleInstances(!0)),Z(So,bo,n),Z(So,bo,"esm2017")}var yd={".sv":"timestamp"};function Dl(){return yd}function Ol(n){return{".sv":{increment:n}}}var qs=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}};function Ml(n,e,t){var i;if(n=W(n),z("Reference.transaction",n._path),n.key===".length"||n.key===".keys")throw"Reference.transaction failed: "+n.key+" is a read-only object.";let s=(i=t?.applyLocally)!==null&&i!==void 0?i:!0,r=new D,o=(l,c,u)=>{let h=null;l?r.reject(l):(h=new dt(u,new Q(n._repo,n._path),A),r.resolve(new qs(c,h)))},a=di(n,()=>{});return rd(n._repo,n._path,e,o,a,s),r.promise}tr.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};tr.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};md();var vd="@firebase/database-compat",wd="1.0.7";var Ed=new Ye("@firebase/database-compat"),Fl=function(n){let e="FIREBASE WARNING: "+n;Ed.warn(e)};var Cd=function(n,e,t,i){if(!(i&&t===void 0)&&typeof t!="boolean")throw new Error(j(n,e)+"must be a boolean.")},Td=function(n,e,t){if(!(t&&e===void 0))switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(j(n,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}};var Nr=class{constructor(e){this._delegate=e}cancel(e){g("OnDisconnect.cancel",0,1,arguments.length),x("OnDisconnect.cancel","onComplete",e,!0);let t=this._delegate.cancel();return e&&t.then(()=>e(null),i=>e(i)),t}remove(e){g("OnDisconnect.remove",0,1,arguments.length),x("OnDisconnect.remove","onComplete",e,!0);let t=this._delegate.remove();return e&&t.then(()=>e(null),i=>e(i)),t}set(e,t){g("OnDisconnect.set",1,2,arguments.length),x("OnDisconnect.set","onComplete",t,!0);let i=this._delegate.set(e);return t&&i.then(()=>t(null),s=>t(s)),i}setWithPriority(e,t,i){g("OnDisconnect.setWithPriority",2,3,arguments.length),x("OnDisconnect.setWithPriority","onComplete",i,!0);let s=this._delegate.setWithPriority(e,t);return i&&s.then(()=>i(null),r=>i(r)),s}update(e,t){if(g("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){let s={};for(let r=0;r<e.length;++r)s[""+r]=e[r];e=s,Fl("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}x("OnDisconnect.update","onComplete",t,!0);let i=this._delegate.update(e);return t&&i.then(()=>t(null),s=>t(s)),i}};var Pr=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return g("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}};var ze=class n{constructor(e,t){this._database=e,this._delegate=t}val(){return g("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return g("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return g("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return g("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return g("DataSnapshot.child",0,1,arguments.length),e=String(e),gt("DataSnapshot.child","path",e,!1),new n(this._database,this._delegate.child(e))}hasChild(e){return g("DataSnapshot.hasChild",1,1,arguments.length),gt("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return g("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return g("DataSnapshot.forEach",1,1,arguments.length),x("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(t=>e(new n(this._database,t)))}hasChildren(){return g("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return g("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return g("DataSnapshot.ref",0,0,arguments.length),new ye(this._database,this._delegate.ref)}get ref(){return this.getRef()}},fi=class n{constructor(e,t){this.database=e,this._delegate=t}on(e,t,i,s){var r;g("Query.on",2,4,arguments.length),x("Query.on","callback",t,!1);let o=n.getCancelAndContextArgs_("Query.on",i,s),a=(c,u)=>{t.call(o.context,new ze(this.database,c),u)};a.userCallback=t,a.context=o.context;let l=(r=o.cancel)===null||r===void 0?void 0:r.bind(o.context);switch(e){case"value":return di(this._delegate,a,l),t;case"child_added":return Ir(this._delegate,a,l),t;case"child_removed":return Ar(this._delegate,a,l),t;case"child_changed":return Sr(this._delegate,a,l),t;case"child_moved":return br(this._delegate,a,l),t;default:throw new Error(j("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,i){if(g("Query.off",0,3,arguments.length),Td("Query.off",e,!0),x("Query.off","callback",t,!0),wi("Query.off","context",i,!0),t){let s=()=>{};s.userCallback=t,s.context=i,kr(this._delegate,e,s)}else kr(this._delegate,e)}get(){return pl(this._delegate).then(e=>new ze(this.database,e))}once(e,t,i,s){g("Query.once",1,4,arguments.length),x("Query.once","callback",t,!0);let r=n.getCancelAndContextArgs_("Query.once",i,s),o=new D,a=(c,u)=>{let h=new ze(this.database,c);t&&t.call(r.context,h,u),o.resolve(h)};a.userCallback=t,a.context=r.context;let l=c=>{r.cancel&&r.cancel.call(r.context,c),o.reject(c)};switch(e){case"value":di(this._delegate,a,l,{onlyOnce:!0});break;case"child_added":Ir(this._delegate,a,l,{onlyOnce:!0});break;case"child_removed":Ar(this._delegate,a,l,{onlyOnce:!0});break;case"child_changed":Sr(this._delegate,a,l,{onlyOnce:!0});break;case"child_moved":br(this._delegate,a,l,{onlyOnce:!0});break;default:throw new Error(j("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return o.promise}limitToFirst(e){return g("Query.limitToFirst",1,1,arguments.length),new n(this.database,te(this._delegate,vl(e)))}limitToLast(e){return g("Query.limitToLast",1,1,arguments.length),new n(this.database,te(this._delegate,wl(e)))}orderByChild(e){return g("Query.orderByChild",1,1,arguments.length),new n(this.database,te(this._delegate,El(e)))}orderByKey(){return g("Query.orderByKey",0,0,arguments.length),new n(this.database,te(this._delegate,Cl()))}orderByPriority(){return g("Query.orderByPriority",0,0,arguments.length),new n(this.database,te(this._delegate,Tl()))}orderByValue(){return g("Query.orderByValue",0,0,arguments.length),new n(this.database,te(this._delegate,Il()))}startAt(e=null,t){return g("Query.startAt",0,2,arguments.length),new n(this.database,te(this._delegate,ml(e,t)))}startAfter(e=null,t){return g("Query.startAfter",0,2,arguments.length),new n(this.database,te(this._delegate,yl(e,t)))}endAt(e=null,t){return g("Query.endAt",0,2,arguments.length),new n(this.database,te(this._delegate,_l(e,t)))}endBefore(e=null,t){return g("Query.endBefore",0,2,arguments.length),new n(this.database,te(this._delegate,gl(e,t)))}equalTo(e,t){return g("Query.equalTo",1,2,arguments.length),new n(this.database,te(this._delegate,Sl(e,t)))}toString(){return g("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return g("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(g("Query.isEqual",1,1,arguments.length),!(e instanceof n)){let t="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(t)}return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,i){let s={cancel:void 0,context:void 0};if(t&&i)s.cancel=t,x(e,"cancel",s.cancel,!0),s.context=i,wi(e,"context",s.context,!0);else if(t)if(typeof t=="object"&&t!==null)s.context=t;else if(typeof t=="function")s.cancel=t;else throw new Error(j(e,"cancelOrContext")+" must either be a cancel callback or a context object.");return s}get ref(){return new ye(this.database,new Q(this._delegate._repo,this._delegate._path))}},ye=class n extends fi{constructor(e,t){super(e,new V(t._repo,t._path,new Vt,!1)),this.database=e,this._delegate=t}getKey(){return g("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return g("Reference.child",1,1,arguments.length),typeof e=="number"&&(e=String(e)),new n(this.database,De(this._delegate,e))}getParent(){g("Reference.parent",0,0,arguments.length);let e=this._delegate.parent;return e?new n(this.database,e):null}getRoot(){return g("Reference.root",0,0,arguments.length),new n(this.database,this._delegate.root)}set(e,t){g("Reference.set",1,2,arguments.length),x("Reference.set","onComplete",t,!0);let i=hi(this._delegate,e);return t&&i.then(()=>t(null),s=>t(s)),i}update(e,t){if(g("Reference.update",1,2,arguments.length),Array.isArray(e)){let s={};for(let r=0;r<e.length;++r)s[""+r]=e[r];e=s,Fl("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}z("Reference.update",this._delegate._path),x("Reference.update","onComplete",t,!0);let i=fl(this._delegate,e);return t&&i.then(()=>t(null),s=>t(s)),i}setWithPriority(e,t,i){g("Reference.setWithPriority",2,3,arguments.length),x("Reference.setWithPriority","onComplete",i,!0);let s=dl(this._delegate,e,t);return i&&s.then(()=>i(null),r=>i(r)),s}remove(e){g("Reference.remove",0,1,arguments.length),x("Reference.remove","onComplete",e,!0);let t=ul(this._delegate);return e&&t.then(()=>e(null),i=>e(i)),t}transaction(e,t,i){g("Reference.transaction",1,3,arguments.length),x("Reference.transaction","transactionUpdate",e,!1),x("Reference.transaction","onComplete",t,!0),Cd("Reference.transaction","applyLocally",i,!0);let s=Ml(this._delegate,e,{applyLocally:i}).then(r=>new Pr(r.committed,new ze(this.database,r.snapshot)));return t&&s.then(r=>t(null,r.committed,r.snapshot),r=>t(r,!1,null)),s}setPriority(e,t){g("Reference.setPriority",1,2,arguments.length),x("Reference.setPriority","onComplete",t,!0);let i=hl(this._delegate,e);return t&&i.then(()=>t(null),s=>t(s)),i}push(e,t){g("Reference.push",0,2,arguments.length),x("Reference.push","onComplete",t,!0);let i=cl(this._delegate,e),s=i.then(o=>new n(this.database,o));t&&s.then(()=>t(null),o=>t(o));let r=new n(this.database,i);return r.then=s.then.bind(s),r.catch=s.catch.bind(s,void 0),r}onDisconnect(){return z("Reference.onDisconnect",this._delegate._path),new Nr(new Kn(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}};var qe=class{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:Al,forceLongPolling:kl}}useEmulator(e,t,i={}){Rl(this._delegate,e,t,i)}ref(e){if(g("database.ref",0,1,arguments.length),e instanceof ye){let t=Tr(this._delegate,e.toString());return new ye(this,t)}else{let t=Cr(this._delegate,e);return new ye(this,t)}}refFromURL(e){g("database.refFromURL",1,1,arguments.length);let i=Tr(this._delegate,e);return new ye(this,i)}goOffline(){return g("database.goOffline",0,0,arguments.length),Nl(this._delegate)}goOnline(){return g("database.goOnline",0,0,arguments.length),Pl(this._delegate)}};qe.ServerValue={TIMESTAMP:Dl(),increment:n=>Ol(n)};function Id({app:n,url:e,version:t,customAuthImpl:i,customAppCheckImpl:s,namespace:r,nodeAdmin:o=!1}){Ys(t);let a=new Ei("database-standalone"),l=new fn("auth-internal",a);l.setComponent(new ge("auth-internal",()=>i,"PRIVATE"));let c;return s&&(c=new fn("app-check-internal",a),c.setComponent(new ge("app-check-internal",()=>s,"PRIVATE"))),{instance:new qe(Rr(n,l,c,e,o),n),namespace:r}}var Sd=Object.freeze({__proto__:null,initStandalone:Id});var bd=qe.ServerValue;function Ad(n){n.INTERNAL.registerComponent(new ge("database-compat",(e,{instanceIdentifier:t})=>{let i=e.getProvider("app-compat").getImmediate(),s=e.getProvider("database").getImmediate({identifier:t});return new qe(s,i)},"PUBLIC").setServiceProps({Reference:ye,Query:fi,Database:qe,DataSnapshot:ze,enableLogging:xl,INTERNAL:Sd,ServerValue:bd}).setMultipleInstances(!0)),n.registerVersion(vd,wd)}Ad($);function rn(n,e,t="on",i=on){return new ve(s=>{let r=null;return r=n[t](e,(o,a)=>{i.schedule(()=>{s.next({snapshot:o,prevKey:a})}),t==="once"&&i.schedule(()=>s.complete())},o=>{i.schedule(()=>s.error(o))}),t==="on"?{unsubscribe(){r!=null&&n.off(e,r)}}:{unsubscribe(){}}}).pipe(K(s=>{let{snapshot:r,prevKey:o}=s,a=null;return r.exists()&&(a=r.key),{type:e,payload:r,prevKey:o,key:a}}),Ur())}function kd(n){return typeof n=="string"}function Rd(n){return typeof n.exportVal=="function"}function Vl(n){return n==null}function jl(n){return typeof n.set=="function"}function Ll(n,e){return jl(e)?e:n.ref(e)}function Hl(n,e){if(kd(n))return e.stringCase();if(jl(n))return e.firebaseCase();if(Rd(n))return e.snapshotCase();throw new Error(`Expects a string, snapshot, or reference. Got: ${typeof n}`)}function Gl(n){return(Vl(n)||n.length===0)&&(n=["child_added","child_removed","child_changed","child_moved"]),n}function Kl(n,e,t){e=Gl(e);let i=e.map(s=>rn(n,s,"on",t));return yt(...i)}function Nd(n,e,t){let i=Kl(n,e).pipe(_i((s,r)=>[...s,r],[]));return xd(n,i,t)}function Pd(n,e){return rn(n,"value","on",e).pipe(K(t=>{let i;return t.payload.forEach(s=>(i=s.key,!1)),{data:t,lastKeyToLoad:i}}))}function xd(n,e,t){return Pd(n,t).pipe(jr(e),K(([s,r])=>{let o=s.lastKeyToLoad,a=r.map(l=>l.key);return{actions:r,lastKeyToLoad:o,loadedKeys:a}}),Br(s=>s.loadedKeys.indexOf(s.lastKeyToLoad)===-1),K(s=>s.actions))}function Wl(n,e){return function(i,s){return Hl(i,{stringCase:()=>n.child(i)[e](s),firebaseCase:()=>i[e](s),snapshotCase:()=>i.ref[e](s)})}}function Dd(n){return function(t){return t?Hl(t,{stringCase:()=>n.child(t).remove(),firebaseCase:()=>t.remove(),snapshotCase:()=>t.ref.remove()}):n.remove()}}function Od(n,e,t){return rn(n,"value","once",t).pipe(_e(i=>{let s=[Le(i)];return e.forEach(r=>s.push(rn(n,r,"on",t))),yt(...s).pipe(_i(Fd,[]))}),Lr())}function $l(n,e){let t=n.length;for(let i=0;i<t;i++)if(n[i].payload.key===e)return i;return-1}function Md(n,e){if(Vl(e))return 0;{let t=$l(n,e);return t===-1?n.length:t+1}}function Fd(n,e){let{payload:t,prevKey:i,key:s}=e,r=$l(n,s),o=Md(n,i);switch(e.type){case"value":if(e.payload?.exists()){let a=null;e.payload.forEach(l=>{let c={payload:l,type:"value",prevKey:a,key:l.key};return a=l.key,n=[...n,c],!1})}return n;case"child_added":if(r>-1)(n[r-1]?.key||null)!==i&&(n=n.filter(l=>l.payload.key!==t.key),n.splice(o,0,e));else{if(i==null)return[e,...n];n=n.slice(),n.splice(o,0,e)}return n;case"child_removed":return n.filter(a=>a.payload.key!==t.key);case"child_changed":return n.map(a=>a.payload.key===s?e:a);case"child_moved":if(r>-1){let a=n.splice(r,1)[0];return n=n.slice(),n.splice(o,0,a),n}return n;default:return n}}function Ul(n,e,t){return e=Gl(e),Od(n,e,t)}function Ld(n,e){let t=e.schedulers.outsideAngular,i=e.schedulers.ngZone.run(()=>n.ref);return{query:n,update:Wl(i,"update"),set:Wl(i,"set"),push:s=>i.push(s),remove:Dd(i),snapshotChanges(s){return Ul(n,s,t).pipe(ce)},stateChanges(s){return Kl(n,s,t).pipe(ce)},auditTrail(s){return Nd(n,s,t).pipe(ce)},valueChanges(s,r){return Ul(n,s,t).pipe(K(a=>a.map(l=>r&&r.idField?Dr(xr({},l.payload.val()),{[r.idField]:l.key}):l.payload.val())),ce)}}}function Bl(n,e){return function(){return rn(n,"value","on",e)}}function Wd(n,e){return{query:n,snapshotChanges(){return Bl(n,e.schedulers.outsideAngular)().pipe(ce)},update(t){return n.ref.update(t)},set(t){return n.ref.set(t)},remove(){return n.ref.remove()},valueChanges(){return Bl(n,e.schedulers.outsideAngular)().pipe(ce,K(i=>i.payload.exists()?i.payload.val():null))}}}var Ud=new L("angularfire2.realtimeDatabaseURL"),Bd=new L("angularfire2.database.use-emulator"),zl=(()=>{class n{schedulers;database;constructor(t,i,s,r,o,a,l,c,u,h,d,p,_,E,S){this.schedulers=a;let H=l,G=St(t,o,i);c&&Li(G,o,u,d,p,_,h,E),this.database=En(`${G.name}.database.${s}`,"AngularFireDatabase",G.name,()=>{let k=o.runOutsideAngular(()=>G.database(s||void 0));return H&&k.useEmulator(...H),k},[H])}list(t,i){let s=this.schedulers.ngZone.runOutsideAngular(()=>Ll(this.database,t)),r=s;return i&&(r=i(s)),Ld(r,this)}object(t){let i=this.schedulers.ngZone.runOutsideAngular(()=>Ll(this.database,t));return Wd(i,this)}createPushId(){return this.schedulers.ngZone.runOutsideAngular(()=>this.database.ref()).push().key}static \u0275fac=function(i){return new(i||n)(C(Je),C(et,8),C(Ud,8),C(Ce),C(ae),C(Ze),C(Bd,8),C(Io,8),C(Pi,8),C(xi,8),C(Di,8),C(Oi,8),C(Mi,8),C(Fi,8),C(Ue,8))};static \u0275prov=Ee({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();var xp=(()=>{let e=class e{constructor(i){this.db=i}saveFormData(i){return this.db.list("/formData").push(i)}getContentData(){return this.db.list("/formData",i=>i.limitToLast(1)).snapshotChanges().pipe(K(i=>{let s=i[0]?.payload.val();return s||null}))}};e.\u0275fac=function(s){return new(s||e)(C(zl))},e.\u0275prov=Ee({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();export{Ie as a,Yd as b,Yl as c,Ue as d,Ze as e,ao as f,Tt as g,Ti as h,af as i,lf as j,jf as k,xp as l};
